# راهنمای آزمون‌های حسابرسی مبتنی بر هوش مصنوعی
# AI-Powered Audit Tests Guide

## نمای کلی

این پروژه شامل چهار آزمون حسابرسی پیشرفته مبتنی بر یادگیری ماشین و هوش مصنوعی است که برای شناسایی ناهنجاری‌ها و الگوهای مشکوک در داده‌های مالی طراحی شده‌اند.

## آزمون‌های موجود

### 1. آزمون Isolation Forest (ai_isolation_forest_test)

**توضیح**: از الگوریتم غیرنظارتی Isolation Forest برای شناسایی تراکنش‌های منزوی و غیرعادی استفاده می‌کند.

**ویژگی‌های ورودی**:
- مبلغ تراکنش
- ساعت روز (0-23)
- روز هفته (0-6)
- کد حساب

**پارامترها**:
- `columnName`: نام ستون مبلغ (Debit یا Credit)
- `contamination`: نسبت ناهنجاری مورد انتظار (پیش‌فرض: 0.1)
- `minAmount`: حداقل مبلغ برای بررسی (پیش‌فرض: 0)

**خروجی**:
- شناسه تراکنش، تاریخ، کد حساب، مبلغ
- ساعت روز و روز هفته
- امتیاز ناهنجاری (پایین‌تر = مشکوک‌تر)
- رتبه‌بندی بر اساس شدت انحراف

**کاربردها**:
- شناسایی تراکنش‌های مشکوک
- تشخیص الگوهای غیرعادی در زمان‌بندی
- یافتن تراکنش‌های خارج از الگوی معمول

---

### 2. آزمون خوشه‌بندی K-Means (ai_kmeans_clustering_test)

**توضیح**: تراکنش‌ها را به گروه‌های مشابه تقسیم می‌کند و موارد دور از مرکز خوشه یا در خوشه‌های کوچک را شناسایی می‌کند.

**ویژگی‌های ورودی**:
- مبلغ تراکنش
- ساعت روز (0-23)
- روز هفته (0-6)
- روز ماه (1-31)
- کد حساب

**پارامترها**:
- `columnName`: نام ستون مبلغ (Debit یا Credit)
- `nClusters`: تعداد خوشه‌ها (پیش‌فرض: 5)
- `minClusterSize`: حداقل اندازه خوشه به درصد (پیش‌فرض: 1%)
- `distanceThreshold`: آستانه فاصله از مرکز (پیش‌فرض: 2.5)

**خروجی**:
- اطلاعات تراکنش
- شناسه خوشه و اندازه خوشه
- فاصله از مرکز خوشه
- نیاز به بررسی (بله/خیر)
- دلیل بررسی (خوشه کوچک، دور از مرکز)

**کاربردها**:
- گروه‌بندی تراکنش‌های مشابه
- شناسایی تراکنش‌های منفرد
- تشخیص الگوهای غیرمعمول
- یافتن تراکنش‌های استثنایی

---

### 3. آزمون ناهنجاری زمینه‌ای (ai_contextual_anomaly_test)

**توضیح**: ناهنجاری‌ها را در زمینه خاص هر حساب شناسایی می‌کند. میانگین و انحراف معیار هر حساب را جداگانه محاسبه می‌کند.

**روش کار**:
1. تراکنش‌ها را بر اساس کد حساب گروه‌بندی می‌کند
2. برای هر حساب، میانگین و انحراف معیار محاسبه می‌شود
3. تراکنش‌های با بیش از N انحراف معیار از میانگین شناسایی می‌شوند

**پارامترها**:
- `columnName`: نام ستون مبلغ (Debit یا Credit)
- `sigmaThreshold`: آستانه انحراف معیار (پیش‌فرض: 3.0)
- `minTransactionsPerAccount`: حداقل تراکنش در حساب (پیش‌فرض: 5)

**خروجی**:
- اطلاعات تراکنش
- میانگین و انحراف معیار حساب
- انحراف از میانگین
- تعداد سیگما (چند برابر انحراف معیار)
- نوع ناهنجاری (بالا/پایین با شدت)

**سطوح شدت**:
- بسیار بالا/پایین: >5σ
- خیلی بالا/پایین: 4-5σ
- بالا/پایین: 3-4σ

**کاربردها**:
- شناسایی تراکنش‌های غیرعادی در حساب‌های خاص
- تشخیص اشتباهات ورود داده
- یافتن تراکنش‌های مشکوک به تقلب
- کنترل کیفیت داده‌های مالی

---

### 4. آزمون پیشرفته بنفورد (ai_benford_advanced_test)

**توضیح**: تحلیل پیشرفته قانون بنفورد که علاوه بر رقم اول، ارقام دوم و سوم تراکنش‌های با مبالغ بالا را نیز بررسی می‌کند.

**دو نوع تحلیل**:

1. **بنفورد سنتی (رقم اول)**:
   - تمام تراکنش‌ها
   - مقایسه با توزیع بنفورد
   - شناسایی انحرافات قابل توجه

2. **تحلیل پیشرفته AI (ارقام دوم و سوم)**:
   - فقط مبالغ بالا (صدک 90 به بالا)
   - مقایسه با توزیع یکنواخت
   - شناسایی الگوهای غیرطبیعی

**پارامترها**:
- `columnName`: نام ستون مبلغ (Debit یا Credit)
- `topPercentile`: صدک بالایی برای انتخاب مبالغ بالا (پیش‌فرض: 90)
- `chiSquareThreshold`: آستانه Chi-Square (پیش‌فرض: 15.51)

**خروجی**:
- موقعیت رقم و مقدار رقم
- تعداد واقعی و مورد انتظار
- درصد واقعی و مورد انتظار
- تفاضل و سهم Chi-Square
- شدت انحراف
- نوع تحلیل

**مزایا**:
- تشخیص دستکاری‌های هوشمندانه
- تمرکز بر مبالغ بالا
- شناسایی الگوهای تکراری

**کاربردها**:
- تشخیص دستکاری در اعداد مالی
- شناسایی تراکنش‌های جعلی
- کشف الگوهای غیرطبیعی
- شناسایی دستکاری‌های پیچیده

---

## نیازمندی‌ها

### کتابخانه‌های Python
```
scikit-learn >= 1.3.2
numpy >= 1.26.4
```

### حداقل داده
- **Isolation Forest**: حداقل 10 تراکنش
- **K-Means**: حداقل تعداد تراکنش برابر با تعداد خوشه‌ها
- **Contextual Anomaly**: حداقل 5 تراکنش در هر حساب
- **Advanced Benford**: حداقل 30 تراکنش

---

## نحوه استفاده

### از طریق خط فرمان

```bash
# دریافت پارامترها
python query_runner.py --query ai_isolation_forest_test --get-parameters

# اجرای آزمون با پارامترهای پیش‌فرض
python query_runner.py --query ai_isolation_forest_test

# اجرای آزمون با پارامترهای سفارشی
python query_runner.py --query ai_isolation_forest_test '{"contamination": 0.05, "minAmount": 1000}'
```

### از طریق رابط وب

1. باز کردن رابط وب
2. انتخاب یکی از آزمون‌های AI:
   - ai_isolation_forest_test
   - ai_kmeans_clustering_test
   - ai_contextual_anomaly_test
   - ai_benford_advanced_test
3. تنظیم پارامترها
4. اجرای آزمون و مشاهده نتایج

---

## نکات مهم

### امنیت و حریم خصوصی
- تمام محاسبات به صورت محلی انجام می‌شود
- هیچ داده‌ای به سرورهای خارجی ارسال نمی‌شود
- مدل‌های ML بر روی داده‌های خود شما آموزش داده می‌شوند

### عملکرد
- برای مجموعه داده‌های بزرگ (>100,000 تراکنش) ممکن است زمان بیشتری نیاز باشد
- Isolation Forest و K-Means نرمال‌سازی ویژگی‌ها را انجام می‌دهند
- استفاده از کدگذاری تعیین‌گرا برای کدهای حساب (ASCII sum)

### تفسیر نتایج
- نتایج باید به عنوان **راهنما** در نظر گرفته شوند، نه قطعی
- ناهنجاری‌ها لزوماً به معنای تقلب نیستند
- نیاز به بررسی دستی موارد شناسایی شده
- ترکیب نتایج چند آزمون برای دقت بیشتر

### بهترین روش‌ها
1. ابتدا با پارامترهای پیش‌فرض شروع کنید
2. پارامترها را بر اساس نتایج تنظیم کنید
3. از چند آزمون مختلف استفاده کنید
4. موارد شناسایی شده را به صورت دستی بررسی کنید
5. نتایج را با سایر آزمون‌های حسابرسی ترکیب کنید

---

## مثال‌های کاربردی

### مثال 1: شناسایی تراکنش‌های مشکوک شبانه

```bash
python query_runner.py --query ai_isolation_forest_test '{"columnName": "Debit", "contamination": 0.05}'
```

موارد شناسایی شده ممکن است شامل تراکنش‌های انجام شده در ساعات غیرمعمول باشند.

### مثال 2: یافتن حساب‌هایی با تراکنش‌های غیرعادی

```bash
python query_runner.py --query ai_contextual_anomaly_test '{"sigmaThreshold": 2.5}'
```

این آزمون تراکنش‌های خارج از محدوده معمول هر حساب را شناسایی می‌کند.

### مثال 3: تحلیل مبالغ بالا برای دستکاری احتمالی

```bash
python query_runner.py --query ai_benford_advanced_test '{"topPercentile": 95}'
```

این آزمون بالاترین 5% مبالغ را برای انحرافات رقمی بررسی می‌کند.

---

## عیب‌یابی

### خطای "scikit-learn not installed"
```bash
pip install scikit-learn>=1.3.2 numpy>=1.26.4
```

### خطای "Not enough transactions"
- داده‌های بیشتری اضافه کنید
- پارامتر `minAmount` را کاهش دهید
- تعداد خوشه‌ها را کاهش دهید (در K-Means)

### نتایج غیرمنتظره
- پارامترها را بازنگری کنید
- با پارامترهای پیش‌فرض شروع کنید
- مستندات هر آزمون را مطالعه کنید

---

## پشتیبانی و توسعه

برای گزارش مشکلات یا پیشنهادات، لطفاً یک Issue در GitHub ایجاد کنید.

### توسعه‌های آینده
- افزودن مدل‌های دیگر (DBSCAN، Local Outlier Factor)
- پشتیبانی از ویژگی‌های اضافی (مرکز هزینه، پروژه)
- تحلیل سری زمانی با LSTM
- تشخیص تقلب با شبکه‌های عصبی

---

## مراجع

- [Isolation Forest Paper](https://cs.nju.edu.cn/zhouzh/zhouzh.files/publication/icdm08b.pdf)
- [K-Means Clustering](https://scikit-learn.org/stable/modules/clustering.html#k-means)
- [Benford's Law](https://en.wikipedia.org/wiki/Benford%27s_law)
- [Statistical Anomaly Detection](https://en.wikipedia.org/wiki/Anomaly_detection)

---

تاریخ ایجاد: 2026-01-25  
نسخه: 1.0.0
