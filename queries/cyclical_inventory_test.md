# مستندات آزمون الگوی دوره‌ای موجودی

## نام آزمون
**آزمون الگوی دوره‌ای موجودی** (Cyclical Inventory Pattern Test)

## هدف و کاربرد در حسابرسی

### چرا از این آزمون استفاده می‌کنیم؟
سطح موجودی کالا در کسب‌وکارهای تولیدی و تجاری باید از یک الگوی منطقی و قابل پیش‌بینی پیروی کند. نوسانات طبیعی موجودی معمولاً مرتبط با چرخه فروش، خرید، و تولید است. اما نوسانات شدید و غیرمنطقی می‌تواند نشانه‌ای از مشکلات جدی باشد: سرقت، ضایعات پنهان، دستکاری در ارزش‌گذاری، یا مدیریت ضعیف موجودی.

**در حسابرسی از این آزمون برای:**
- **کشف دستکاری در موجودی:** شناسایی تغییرات مصنوعی برای تاثیر بر سود
- **تشخیص سرقت و اختلاس:** کاهش‌های غیرتوجیه‌پذیر در سطح موجودی
- **شناسایی موجودی کاذب:** افزایش‌های ناگهانی که ممکن است واقعی نباشند
- **ارزیابی کنترل‌های موجودی:** شناسایی ضعف در مدیریت و نگهداری موجودی

### کاربردهای عملی:
- تشخیص سرقت کالا از انبار
- شناسایی ضایعات پنهان‌شده
- کشف اشتباهات در شمارش موجودی
- تشخیص دستکاری برای افزایش مصنوعی سود

## پارامترهای ورودی

### 1. آستانه نوسان (volatilityThreshold)
- **نوع:** عدد (Number)
- **مقدار پیش‌فرض:** 40.0٪
- **توضیح:** حد آستانه برای تعیین نوسان غیرعادی در موجودی
- **نحوه محاسبه:**
  - نوسان = (انحراف معیار / میانگین موجودی) × 100
  - اگر نوسان >= 40٪ ➡️ غیرعادی و مشکوک
- **مفهوم:**
  - نوسان 40٪ یعنی موجودی به طور متوسط 40٪ از میانگین خود بالا یا پایین می‌رود
  - در موجودی‌های سالم، نوسان معمولاً کمتر از 30٪ است
- **راهنما:**
  - مقادیر پایین‌تر (25-30٪): حساسیت بیشتر، شناسایی نوسانات کوچک‌تر
  - مقادیر بالاتر (50-60٪): فقط نوسانات بسیار شدید
  - برای کالاهای فصلی: 50-60٪
  - برای کالاهای عادی: 30-40٪
- **مثال:** 
  - کالای A: میانگین موجودی 1000 عدد، انحراف معیار 450 عدد
  - نوسان = (450 / 1000) × 100 = 45٪ ➡️ مشکوک

## ستون‌های خروجی

خروجی این آزمون فقط شامل کالاهایی است که نوسان غیرعادی دارند:

### 1. ItemID (شناسه قلم)
- شناسه یکتای کالا در سیستم
- برای ردیابی و بررسی بیشتر استفاده می‌شود

### 2. Period (دوره)
- دوره زمانی به فرمت YYYY-MM (مثلاً 2024-01)
- نشان‌دهنده ماهی که تراکنش در آن رخ داده

### 3. BeginningInventory (موجودی اول دوره)
- سطح موجودی در ابتدای دوره (ماه)
- برابر است با موجودی پایان دوره قبل
- واحد: تعداد (عدد، کیلوگرم، لیتر و غیره)

### 4. Purchases (خرید)
- مجموع خریدهای کالا در این دوره
- افزایش موجودی به دلیل خرید
- واحد: همان واحد موجودی

### 5. Sales (فروش)
- مجموع فروش کالا در این دوره
- کاهش موجودی به دلیل فروش
- واحد: همان واحد موجودی

### 6. EndingInventory (موجودی آخر دوره)
- سطح موجودی در پایان دوره
- فرمول: موجودی اول + خرید - فروش
- این مقدار موجودی اول دوره بعد می‌شود

### 7. AvgInventory (میانگین موجودی)
- میانگین سطح موجودی در تمام دوره‌ها
- برای محاسبه نوسان استفاده می‌شود
- نشان‌دهنده سطح "عادی" موجودی

### 8. Volatility (نوسان)
- درصد نوسان موجودی
- فرمول: (انحراف معیار / میانگین) × 100
- هر چه بالاتر باشد، نوسان بیشتر و مشکوک‌تر است
- فقط کالاهایی که نوسان >= آستانه نمایش داده می‌شوند

## نحوه انجام آزمون

### مراحل اجرا:

1. **استخراج داده‌ها:** 
   - تمام تراکنش‌های موجودی از پایگاه داده خوانده می‌شوند
   - فقط تراکنش‌هایی که ItemID، Quantity و TransactionDate دارند

2. **گروه‌بندی بر اساس کالا و دوره:**
   - برای هر کالا (ItemID)
   - برای هر ماه (بر اساس TransactionDate)
   - خریدها و فروش‌ها جداگانه جمع می‌شوند

3. **تشخیص نوع تراکنش:**
   - اگر TransactionType = 'Purchase' ➡️ خرید
   - اگر TransactionType = 'Sale' ➡️ فروش
   - مقدار Quantity به خرید یا فروش اضافه می‌شود

4. **محاسبه سطح موجودی:**
   - برای هر دوره به ترتیب زمانی:
     - موجودی ابتدای دوره = موجودی پایان دوره قبل
     - موجودی پایان دوره = موجودی ابتدا + خرید - فروش

5. **محاسبه آمار:**
   - لیست تمام سطوح موجودی پایان دوره ایجاد می‌شود
   - میانگین موجودی محاسبه می‌شود
   - انحراف معیار موجودی محاسبه می‌شود
   - نوسان = (انحراف معیار / میانگین) × 100

6. **فیلتر کردن:**
   - فقط کالاهایی که حداقل 3 دوره داده دارند
   - فقط کالاهایی که نوسان >= آستانه

7. **مرتب‌سازی:** بر اساس نوسان (بالاترین نوسان اول)

## تفسیر نتایج

### نتایج عادی (طبیعی):
- **خروجی خالی یا تعداد کم:** موجودی‌ها در محدوده طبیعی هستند
- نوسان کمتر از 40٪
- تغییرات تدریجی و قابل پیش‌بینی
- موجودی متناسب با خرید و فروش

### نتایج مشکوک:

#### نوسان بسیار بالا (> 80٪):
**علل طبیعی:**
- کالاهای فصلی با تقاضای بسیار متغیر
- محصولات جدید در حال معرفی
- قرارداد فروش بزرگ یکباره

**علل مشکوک:**
- **سرقت:** کاهش ناگهانی بدون فروش ثبت شده
- **دستکاری در شمارش:** تغییر مصنوعی موجودی برای افزایش سود
- **کالای جعلی:** ثبت خرید کالا بدون دریافت واقعی
- **ضایعات پنهان:** از بین رفتن کالا بدون ثبت

#### نوسان متوسط (40-80٪):
**علل طبیعی:**
- تغییرات در استراتژی خرید
- نوسانات طبیعی تقاضا
- تغییر تامین‌کنندگان

**علل مشکوک:**
- **مدیریت ضعیف موجودی:** خریدهای بی‌رویه
- **اشتباه در ثبت:** خطاهای منظم در ثبت ورود و خروج
- **برداشت غیرمجاز:** خروج کالا بدون مجوز

### الگوهای خطرناک:

1. **کاهش ناگهانی موجودی:**
   - موجودی پایان دوره بسیار کمتر از انتظار
   - احتمال: سرقت، ضایعات، یا فروش ثبت نشده

2. **افزایش ناگهانی موجودی:**
   - خرید زیاد بدون افزایش متناسب در فروش
   - احتمال: خرید غیرضروری، یا ثبت خرید جعلی برای افزایش دارایی

3. **موجودی منفی:**
   - فروش بیشتر از موجودی موجود
   - احتمال: خطای سیستمی، یا فروش کالای موجود نبوده

4. **نوسان شدید بدون الگو:**
   - یک ماه بالا، ماه بعد پایین، بدون دلیل مشخص
   - احتمال: دستکاری یا عدم کنترل

## مثال عملی

### سناریو:
یک شرکت توزیع لوازم الکترونیکی با 500 قلم کالا.

### تنظیمات:
- volatilityThreshold: 40.0

### نتیجه نمونه:
```
شناسه | دوره   | موجودی اول | خرید | فروش | موجودی آخر | میانگین | نوسان
P001  | 2023-09| 1000      | 500  | 400  | 1100       | 1200    | 65.5% ⚠️
P001  | 2023-10| 1100      | 0    | 100  | 1000       | 1200    | 65.5%
P001  | 2023-11| 1000      | 200  | 150  | 1050       | 1200    | 65.5%
P001  | 2023-12| 1050      | 800  | 300  | 1550       | 1200    | 65.5%
P001  | 2024-01| 1550      | 0    | 1200 | 350        | 1200    | 65.5%
P001  | 2024-02| 350       | 1500 | 200  | 1650       | 1200    | 65.5%

P002  | 2023-09| 500       | 200  | 150  | 550        | 600     | 82.3% ⚠️⚠️
P002  | 2023-10| 550       | 0    | 100  | 450        | 600     | 82.3%
P002  | 2023-11| 450       | 100  | 500  | 50         | 600     | 82.3%
P002  | 2023-12| 50        | 800  | 50   | 800        | 600     | 82.3%
```

### تحلیل:

**کالای P001 (نوسان 65.5٪):**
- نوسان قابل توجه اما با الگو
- **مشاهدات:**
  - دسامبر: خرید زیاد (800) + موجودی بالا (1550)
  - ژانویه: فروش بالا (1200) + موجودی پایین (350)
  - فوریه: خرید مجدد زیاد (1500) + موجودی بالا (1650)
- **تحلیل:**
  - احتمالاً کالای فصلی با اوج فروش در ژانویه
  - خرید عمده قبل از فصل فروش
  - الگوی منطقی اما نوسان بالا
- **توصیه:**
  - بررسی آیا این الگو با سال قبل تطابق دارد
  - بهینه‌سازی سیاست خرید برای کاهش نوسان

**کالای P002 (نوسان 82.3٪ - بسیار مشکوک):**
- نوسان بسیار بالا و الگوی عجیب
- **مشاهدات:**
  - نوامبر: فروش 500 در حالی که موجودی فقط 450 بود ➡️ موجودی پایانی 50
  - دسامبر: موجودی ناگهان به 800 رسید (خرید 800)
  - تفاوت زیاد بین دوره‌ها: از 50 تا 800
- **علائم خطر:**
  - فروش بیشتر از موجودی (نوامبر: 500 فروش با 450 موجودی)
  - نوسان شدید بدون الگوی منطقی
  - احتمال خطا در ثبت یا مشکل واقعی
- **اقدامات فوری:**
  - شمارش فیزیکی موجودی فعلی
  - بررسی تمام فاکتورهای خرید و فروش
  - مصاحبه با انباردار
  - بررسی احتمال سرقت یا ضایعات

## نکات مهم

### محدودیت‌ها:
- ❌ برای کالاهای جدید (کمتر از 3 ماه) قابل اعتماد نیست
- ❌ کالاهای با فروش بسیار کم یا صفر نتیجه معنادار ندارند
- ❌ تنها نوسان را اندازه می‌گیرد، علت آن را مشخص نمی‌کند
- ❌ فرض می‌کند که داده‌های ورودی صحیح هستند

### بهترین کاربردها:
- ✅ کالاهای با حداقل 3-6 ماه سابقه
- ✅ کالاهای با گردش منظم (نه خیلی کم، نه خیلی زیاد)
- ✅ کالاهای با ارزش بالا که ارزش پیگیری دارند
- ✅ محصولاتی که مستعد سرقت هستند
- ✅ کالاهای با مشکلات قبلی در موجودی

### توصیه‌ها:
1. **آستانه را تنظیم کنید** بر اساس نوع کسب‌وکار
2. **با شمارش فیزیکی تایید کنید** - نوسان بالا = اولویت برای شمارش
3. **الگوهای فصلی را در نظر بگیرید** - بعضی کالاها ذاتاً نوسان دارند
4. **با مدیر انبار مشورت کنید** - آیا دلیل منطقی وجود دارد؟
5. **روند بلندمدت را ببینید** - آیا نوسان در حال افزایش است؟

### نشانه‌های سرقت در موجودی:
- کاهش پیوسته موجودی در چند ماه
- اختلاف بین موجودی دفتری و فیزیکی
- نوسان شدید در کالاهای با ارزش بالا
- موجودی منفی (فروش بیش از موجود)

### نشانه‌های دستکاری:
- افزایش ناگهانی موجودی در پایان سال
- الگوهای منظم و غیرطبیعی
- موجودی بالا همراه با فروش پایین (کالای رکود)
- تطابق نداشتن با اسناد خرید

## ارتباط با سایر آزمون‌ها

### آزمون‌های مکمل:

**1. آزمون موجودی کند‌گردش:**
- کالاهایی که نوسان کمی دارند و نمی‌فروشند
- مکمل این آزمون - کالاهای مشکل‌دار از جهت دیگر

**2. آزمون الگوی دوره‌ای فروش:**
- بررسی تطابق نوسانات موجودی با نوسانات فروش
- اگر فروش ثابت اما موجودی نوسان دارد ➡️ مشکوک

**3. آزمون ارزش‌گذاری موجودی:**
- نوسانات می‌توانند بر ارزش موجودی تاثیر بگذارند
- بررسی آیا ارزش‌گذاری صحیح است

**4. آزمون تطبیق مصرف موجودی:**
- مقایسه موجودی دفتری با موجودی فیزیکی
- تایید صحت محاسبات

**5. آزمون الگوی دوره‌ای جریان نقدی:**
- آیا خریدهای موجودی با پرداخت‌های نقدی تطابق دارد؟

### نحوه استفاده ترکیبی:

**سناریوی تحقیق سرقت موجودی:**
```
مرحله 1: آزمون الگوی دوره‌ای موجودی
         ↓ شناسایی کالای P002 با نوسان 82٪
         
مرحله 2: بررسی تاریخچه فروش
         ↓ فروش 500 در حالی که موجودی 450 بود
         
مرحله 3: شمارش فیزیکی
         ↓ اختلاف 150 عددی با دفاتر
         
مرحله 4: بررسی کنترل‌های دسترسی
         ↓ شناسایی کارمند مشکوک با دسترسی نامحدود
         
مرحله 5: آزمون تفکیک وظایف
         ↓ همان کارمند هم انباردار و هم ثبت‌کننده است
         
نتیجه: شواهد قوی برای سرقت منظم
```

**سناریوی تحقیق دستکاری در سود:**
```
مرحله 1: آزمون الگوی دوره‌ای موجودی
         ↓ افزایش ناگهانی موجودی در پایان سال
         
مرحله 2: آزمون فاکتورهای خرید
         ↓ فاکتورهای خرید عجیب در روزهای آخر سال
         
مرحله 3: بررسی اسناد دریافت
         ↓ کالا بعد از پایان سال دریافت شده
         
مرحله 4: آزمون ارزش‌گذاری موجودی
         ↓ ارزش‌گذاری بیش از حد برای افزایش سود
         
نتیجه: دستکاری برای افزایش مصنوعی سود
```

## مراجع و منابع

- **استانداردهای حسابداری موجودی (IAS 2):** ارزش‌گذاری و افشای موجودی
- **کنترل‌های داخلی موجودی:** اهمیت شمارش دوره‌ای و تفکیک وظایف
- **مدل‌های مدیریت موجودی:** EOQ، Just-in-Time و تاثیر آن‌ها بر نوسانات
- **تشخیص سرقت موجودی:** الگوهای مشکوک و روش‌های کشف
- **تحلیل آماری:** استفاده از انحراف معیار و ضریب تغییرات
