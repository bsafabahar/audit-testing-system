# مستندات آزمون تحلیل شبکه پیشرفته

## نام آزمون
**آزمون تحلیل شبکه** (Advanced Network Analysis Test)

## هدف و کاربرد در حسابرسی

### چرا از این آزمون استفاده می‌کنیم؟
در بسیاری از طرح‌های تقلب، افراد یا شرکت‌های متعدد با یکدیگر در ارتباط هستند و شبکه‌های پیچیده‌ای از تراکنش‌ها ایجاد می‌کنند. این آزمون به شناسایی الگوهای غیرعادی در روابط بین موجودیت‌ها (مشتریان، فروشندگان، کارمندان) کمک می‌کند.

**در حسابرسی از این آزمون برای:**
- **کشف شبکه‌های تقلب:** شناسایی گروه‌های منسجمی که با یکدیگر معاملات مشکوک دارند
- **تشخیص مراکز تراکنش مشکوک:** یافتن موجودیت‌هایی که به صورت غیرعادی با افراد زیادی در ارتباط هستند
- **شناسایی واسطه‌گری‌های غیرمجاز:** کشف افرادی که در مرکز شبکه‌های مالی قرار دارند
- **تحلیل الگوهای پرداخت:** بررسی ساختار روابط مالی بین طرفین

### کاربردهای عملی:
- شناسایی شرکت‌های واسطه مشکوک
- کشف کلاه‌برداری‌های چند نفره (collusion)
- یافتن فروشندگان جعلی مرتبط با هم
- تشخیص پولشویی و انتقال وجوه پیچیده

## پارامترهای ورودی

### 1. حداقل تعداد اتصال (minConnections)
- **نوع:** عدد (Number)
- **مقدار پیش‌فرض:** 5
- **توضیح:** حداقل تعداد اتصالاتی که یک موجودیت باید داشته باشد تا در نتایج نمایش داده شود
- **مفهوم:**
  - مقدار پایین (3-5): شناسایی تمام موجودیت‌های فعال
  - مقدار متوسط (10-15): تمرکز بر موجودیت‌های پرارتباط
  - مقدار بالا (20+): شناسایی فقط مراکز اصلی شبکه
- **توصیه:** برای شروع از مقدار 5 استفاده کنید

## ستون‌های خروجی

### 1. EntityID (شناسه موجودیت)
- شناسه منحصر به فرد موجودیت (مشتری، فروشنده، یا کارمند)

### 2. EntityType (نوع موجودیت)
- نوع موجودیت:
  - `Customer`: مشتری
  - `Vendor`: فروشنده
  - `Employee`: کارمند

### 3. ConnectionCount (تعداد اتصال)
- تعداد موجودیت‌های دیگری که این موجودیت با آنها تراکنش دارد
- هر چه بیشتر، شبکه گسترده‌تر

### 4. TransactionCount (تعداد تراکنش)
- مجموع تعداد تراکنش‌های این موجودیت

### 5. TotalAmount (کل مبلغ)
- مجموع مبالغ تمام تراکنش‌های این موجودیت

### 6. ConnectedEntities (موجودیت‌های متصل)
- لیستی از موجودیت‌های متصل (حداکثر 5 مورد نمایش داده می‌شود)
- نمونه: "Vendor:101, Customer:205, Employee:303 ... (+15 more)"

### 7. NetworkScore (امتیاز شبکه)
- امتیاز عددی که میزان مشکوک بودن موجودیت را نشان می‌دهد
- محدوده: 0 تا 75+
- هر چه بالاتر، مشکوک‌تر

### 8. PatternType (نوع الگو)
- طبقه‌بندی الگوی شبکه:
  - `عادی`: فعالیت طبیعی
  - `فعال`: اتصالات قابل توجه (10-20 اتصال)
  - `مرکز شبکه`: اتصالات بسیار زیاد (20+ اتصال)

## نحوه انجام آزمون

### مراحل اجرا:
1. **دریافت داده‌ها:** تمام تراکنش‌ها از پایگاه داده استخراج می‌شوند

2. **استخراج موجودیت‌ها:** برای هر تراکنش:
   - شناسه مشتری (CustomerID)
   - شناسه فروشنده (VendorID)
   - شناسه کارمند (EmployeeID)

3. **ساخت گراف شبکه:**
   - برای هر جفت موجودیت در یک تراکنش، یک اتصال ایجاد می‌شود
   - مثال: اگر مشتری A، فروشنده B، و کارمند C در یک تراکنش هستند:
     - A متصل به B
     - A متصل به C
     - B متصل به C

4. **جمع‌آوری آمار:** برای هر موجودیت:
   - تعداد اتصالات شمارش می‌شود
   - تعداد تراکنش‌ها شمارش می‌شود
   - مجموع مبالغ محاسبه می‌شود

5. **محاسبه امتیاز شبکه:**
   - **اتصالات زیاد (20+):** +30 امتیاز → "مرکز شبکه"
   - **اتصالات متوسط (10-20):** +15 امتیاز → "فعال"
   - **تراکنش‌های زیاد (100+):** +20 امتیاز
   - **مبلغ بالا (1 میلیارد+):** +25 امتیاز

6. **فیلتر کردن:**
   - فقط موجودیت‌هایی که تعداد اتصالات آنها بیشتر از آستانه است

7. **مرتب‌سازی:**
   - نتایج بر اساس امتیاز شبکه (بالا به پایین) مرتب می‌شوند

## تفسیر نتایج

### سطوح امتیاز شبکه:

#### 60-75+ امتیاز - بسیار مشکوک
- **ویژگی‌ها:**
  - اتصالات بسیار زیاد (20+ موجودیت)
  - تراکنش‌های پرتعداد
  - مبالغ بسیار بالا
- **احتمالات:**
  - مرکز شبکه پولشویی
  - واسطه‌گری غیرمجاز
  - فروشنده جعلی با ارتباطات گسترده
- **اقدام:** بررسی فوری و دقیق

#### 30-59 امتیاز - مشکوک
- **ویژگی‌ها:**
  - اتصالات قابل توجه
  - فعالیت مالی بالا
- **احتمالات:**
  - فعالیت غیرعادی
  - نیاز به بررسی بیشتر
- **اقدام:** تحلیل تفصیلی روابط

#### کمتر از 30 امتیاز - عادی
- **ویژگی‌ها:**
  - الگوی طبیعی ارتباطات
  - فعالیت معمول
- **اقدام:** پایش عادی

### علائم خطر (Red Flags):

1. **مرکز شبکه با فعالیت کم:**
   - اتصالات زیاد اما تراکنش‌های کم
   - احتمال ایجاد شبکه جعلی

2. **افزایش ناگهانی اتصالات:**
   - موجودیتی که به سرعت اتصالات زیادی پیدا کرده
   - نشانه فعالیت مشکوک

3. **شبکه‌های مجزا:**
   - گروه‌هایی که فقط با هم تراکنش دارند
   - احتمال تبانی یا تقلب دسته‌جمعی

4. **الگوی ستاره‌ای:**
   - یک موجودیت در مرکز با اتصالات زیاد
   - سایر موجودیت‌ها فقط با مرکز در ارتباط هستند
   - نشانه شرکت کاغذی یا واسطه

## مثال عملی

### سناریو:
بررسی شبکه فروشندگان یک شرکت بزرگ

### تنظیمات:
- minConnections: 5

### نتیجه نمونه:
```
شناسه | نوع      | تعداد اتصال | تعداد تراکنش | کل مبلغ      | امتیاز | نوع الگو
V-201  | Vendor   | 25          | 150          | 2,500,000,000| 75     | مرکز شبکه
E-105  | Employee | 18          | 200          | 500,000,000  | 50     | فعال
C-450  | Customer | 12          | 80           | 800,000,000  | 40     | فعال
V-350  | Vendor   | 8           | 30           | 1,200,000,000| 45     | فعال
```

### تحلیل:
1. **V-201 (فروشنده):**
   - امتیاز 75: بسیار مشکوک
   - 25 اتصال: مرکز شبکه
   - مبلغ بالا + تراکنش زیاد
   - **اقدام:** بررسی فوری - احتمال فروشنده جعلی

2. **E-105 (کارمند):**
   - امتیاز 50: مشکوک
   - 18 اتصال: بیش از حد برای یک کارمند
   - **اقدام:** بررسی اختیارات و تایید مجوزها

3. **V-350 (فروشنده):**
   - امتیاز 45: مشکوک
   - اتصالات کم اما مبلغ بالا
   - **اقدام:** بررسی مستندات پرداخت

### اقدامات پیشنهادی:
1. بررسی مدارک ثبتی فروشنده V-201
2. تحلیل الگوی زمانی تراکنش‌ها
3. بررسی ارتباطات واقعی بین موجودیت‌ها
4. تایید اعتبار آدرس‌ها و اطلاعات تماس

## نکات مهم

### محدودیت‌ها:
- ❌ برای مجموعه داده کوچک (کمتر از 100 تراکنش) کاربرد محدود
- ❌ نمی‌تواند قانونی بودن روابط را تایید کند
- ❌ ممکن است در صنایع با شبکه‌های پیچیده طبیعی (مثلاً تجارت) false positive بالا باشد

### بهترین کاربردها:
- ✅ تحلیل شبکه‌های پرداخت
- ✅ کشف فروشندگان و مشتریان مرتبط
- ✅ شناسایی کارمندان در مرکز تراکنش‌های مشکوک
- ✅ تحلیل الگوهای پولشویی

### توصیه‌ها:
1. این آزمون را با آزمون‌های دیگر ترکیب کنید
2. الگوهای شبکه را در طول زمان پایش کنید
3. برای صنایع مختلف آستانه‌های متفاوتی تعریف کنید
4. نتایج را با اطلاعات واقعی کسب‌وکار مقایسه کنید

### اقدامات پیشگیرانه:
- تعریف محدودیت برای تعداد ارتباطات هر موجودیت
- پایش مستمر تغییرات در ساختار شبکه
- اعمال کنترل‌های تفکیک وظایف
- تایید دوسطحی برای مراکز شبکه

## ارتباط با سایر آزمون‌ها

- **آزمون شرکت کاغذی:** برای تایید فروشندگان مشکوک در مرکز شبکه
- **آزمون تراکنش‌های تکراری:** برای یافتن الگوهای تکراری در شبکه
- **آزمون تفکیک وظایف:** برای بررسی کارمندان در مرکز شبکه
- **آزمون نام‌های مشابه:** برای کشف موجودیت‌های جعلی مرتبط

## الگوریتم تحلیل شبکه

### نظریه گراف (Graph Theory):
این آزمون از مفاهیم نظریه گراف استفاده می‌کند:

1. **گره‌ها (Nodes):** هر موجودیت یک گره است
2. **یال‌ها (Edges):** هر تراکنش مشترک یک یال است
3. **درجه گره (Degree):** تعداد اتصالات هر موجودیت
4. **مرکزیت (Centrality):** موجودیت‌هایی که در مرکز شبکه قرار دارند

### انواع الگوهای مشکوک:
- **الگوی ستاره (Star):** یک مرکز با اتصالات شعاعی
- **الگوی زنجیره (Chain):** موجودیت‌های متوالی
- **الگوی کامل (Complete):** همه با همه در ارتباط
- **الگوی دورانی (Cycle):** انتقال وجه دورانی
