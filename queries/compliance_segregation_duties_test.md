# مستندات آزمون تفکیک وظایف

## نام آزمون
**آزمون تفکیک وظایف** (Segregation of Duties Test)

## هدف و کاربرد در حسابرسی

### چرا از این آزمون استفاده می‌کنیم؟
تفکیک وظایف یکی از اصول کلیدی کنترل‌های داخلی است که برای جلوگیری از تقلب و خطا طراحی شده است. طبق این اصل، یک فرد نباید بتواند یک تراکنش مالی را از ابتدا تا انتها به تنهایی انجام دهد. این آزمون کاربرانی را شناسایی می‌کند که دسترسی به وظایف متعارض دارند که می‌تواند فرصتی برای سوءاستفاده ایجاد کند.

**در حسابرسی از این آزمون برای:**
- **شناسایی نقض کنترل‌های داخلی:** تشخیص کاربرانی که می‌توانند تراکنش را ثبت و تایید کنند
- **کاهش ریسک تقلب:** جلوگیری از این که یک فرد بتواند تقلب کند و آن را مخفی نماید
- **ارزیابی ضعف کنترل‌ها:** شناسایی نقاط ضعف در ساختار سازمانی
- **اولویت‌بندی ریسک‌ها:** تعیین شدت تخلفات برای تمرکز بر موارد بحرانی

### کاربردهای عملی:
- شناسایی کارمندانی که می‌توانند سفارش ایجاد و تایید کنند
- تشخیص افرادی که دسترسی به ثبت و نگهداری دارایی دارند
- کشف کاربرانی که قادر به فروش و دریافت وجه هستند
- بررسی تمرکز اختیارات در یک فرد

## پارامترهای ورودی

این آزمون نیاز به پارامتر ورودی ندارد و به صورت خودکار تمام کاربران و دسترسی‌های آن‌ها را تحلیل می‌کند.

### نکات مهم در مورد داده‌های ورودی:
- **UserID:** شناسه کاربر باید در تراکنش‌ها موجود باشد
- **UserName:** نام کاربر برای گزارش‌دهی بهتر (اختیاری)
- **FunctionType یا TransactionType یا EntryType:** نوع وظیفه انجام شده توسط کاربر

## ستون‌های خروجی

خروجی این آزمون فقط شامل کاربرانی است که تخلف در تفکیک وظایف دارند:

### 1. UserID (شناسه کاربر)
- شناسه یکتای کاربر در سیستم
- استفاده می‌شود برای پیگیری و گزارش‌دهی

### 2. UserName (نام کاربر)
- نام کاربر برای شناسایی آسان‌تر
- اگر موجود نباشد، "نامشخص" نمایش داده می‌شود

### 3. FunctionCount (تعداد وظیفه)
- تعداد کل وظایف مختلفی که کاربر دسترسی دارد
- هر چه این عدد بیشتر باشد، تمرکز اختیارات بیشتر است

### 4. Functions (وظایف)
- لیست تمام وظایفی که کاربر انجام داده است
- به صورت جدا شده با کاما (،) نمایش داده می‌شود

### 5. ConflictingFunctions (وظایف متعارض)
- جفت وظایفی که نباید توسط یک نفر انجام شود
- مثال: "Approve-Record" یعنی کاربر می‌تواند هم ثبت و هم تایید کند

### 6. TransactionCount (تعداد تراکنش)
- تعداد کل تراکنش‌هایی که کاربر انجام داده است
- نشان‌دهنده حجم فعالیت کاربر

### 7. ViolationSeverity (شدت تخلف)
- **بحرانی:** 3 یا بیشتر جفت وظیفه متعارض
- **بالا:** 2 جفت وظیفه متعارض
- **متوسط:** 1 جفت وظیفه متعارض

## نحوه انجام آزمون

### مراحل اجرا:
1. **استخراج داده‌ها:** تمام تراکنش‌ها از پایگاه داده خوانده می‌شوند

2. **گروه‌بندی بر اساس کاربر:** 
   - برای هر کاربر، لیست وظایف انجام شده ایجاد می‌شود
   - تعداد تراکنش‌های هر کاربر شمارش می‌شود

3. **استخراج نوع وظایف:**
   - از فیلدهای FunctionType، TransactionType یا EntryType
   - هر وظیفه منحصر به فرد ذخیره می‌شود

4. **تعریف جفت‌های متعارض:**
   - Approve-Record (تایید-ثبت)
   - Initiate-Approve (ایجاد-تایید)
   - Custody-Record (نگهداری-ثبت)
   - Purchase-Receive (خرید-دریافت)
   - Sale-Collect (فروش-دریافت وجه)

5. **بررسی تخلفات:**
   - برای هر کاربر که حداقل 2 وظیفه مختلف دارد
   - بررسی می‌شود آیا جفت‌های متعارض در لیست وظایف او وجود دارد

6. **تعیین شدت تخلف:**
   - بر اساس تعداد جفت‌های متعارض
   - دسته‌بندی در سه سطح: بحرانی، بالا، متوسط

7. **مرتب‌سازی:** نتایج بر اساس شدت تخلف مرتب می‌شوند (بحرانی‌ترین‌ها اول)

## تفسیر نتایج

### نتایج عادی (سالم):
- **خروجی خالی یا تعداد کم:** سیستم کنترل داخلی مناسبی دارد
- کاربران فقط به وظایف غیرمتعارض دسترسی دارند
- تفکیک مناسب وظایف رعایت شده است

### نتایج مشکوک:

#### موارد بحرانی:
- **3+ جفت وظیفه متعارض:** 
  - کاربر تقریباً کنترل کامل بر فرآیند دارد
  - ریسک بسیار بالای تقلب
  - نیاز فوری به محدود کردن دسترسی‌ها

#### موارد با اولویت بالا:
- **2 جفت وظیفه متعارض:**
  - ریسک قابل توجه تقلب
  - نیاز به بررسی دقیق تراکنش‌های این کاربر
  - باید دسترسی‌ها بازبینی شود

#### موارد متوسط:
- **1 جفت وظیفه متعارض:**
  - ریسک موجود اما محدود
  - کنترل‌های جبرانی ممکن است کافی باشد
  - نیاز به پایش مستمر

### جفت‌های وظایف خطرناک:

1. **Approve-Record (تایید-ثبت):**
   - کاربر می‌تواند تراکنش جعلی ثبت و خودش تایید کند
   - یکی از خطرناک‌ترین ترکیب‌ها

2. **Initiate-Approve (ایجاد-تایید):**
   - کاربر می‌تواند درخواست ایجاد و خودش تایید کند
   - امکان سفارشات غیرمجاز

3. **Custody-Record (نگهداری-ثبت):**
   - کاربر هم دارایی را نگهداری و هم ثبت می‌کند
   - امکان سرقت و تغییر سوابق

4. **Purchase-Receive (خرید-دریافت):**
   - کاربر می‌تواند سفارش دهد و خودش تحویل بگیرد
   - ریسک خرید غیرمجاز

5. **Sale-Collect (فروش-دریافت وجه):**
   - امکان فروش و دریافت وجه بدون نظارت
   - ریسک اختلاس وجوه دریافتی

## مثال عملی

### سناریو:
شما می‌خواهید بررسی کنید آیا در بخش خرید شرکت، تفکیک وظایف رعایت شده است.

### نتیجه نمونه:
```
شناسه | نام کاربر    | تعداد وظیفه | وظایف                        | وظایف متعارض                 | تعداد تراکنش | شدت
U001  | احمد رضایی   | 5           | Approve, Initiate, Record... | Approve-Record, Initiate-... | 1250         | بحرانی
U002  | مریم احمدی   | 3           | Purchase, Receive, Approve   | Purchase-Receive             | 450          | متوسط
U003  | علی محمدی    | 4           | Custody, Record, Sale        | Custody-Record               | 890          | متوسط
```

### تحلیل:

**کاربر U001 - احمد رضایی (بحرانی):**
- دارای 5 وظیفه مختلف و چند جفت متعارض
- می‌تواند تراکنش ایجاد، ثبت و تایید کند
- کنترل کامل بر فرآیند دارد
- **توصیه فوری:** 
  - دسترسی‌های تایید را حذف کنید
  - تمام 1250 تراکنش او را بازبینی کنید
  - نقش‌های او را به چند نفر تقسیم کنید

**کاربر U002 - مریم احمدی (متوسط):**
- می‌تواند خرید و دریافت کالا را انجام دهد
- ریسک: سفارش کالای غیرمجاز و تحویل آن
- **توصیه:** 
  - یک فرد دیگر برای تحویل کالا تعیین کنید
  - کنترل‌های جبرانی مانند تایید مدیر را اضافه کنید

**کاربر U003 - علی محمدی (متوسط):**
- نگهداری دارایی و ثبت آن را انجام می‌دهد
- ریسک: تغییر سوابق برای پوشش سرقت
- **توصیه:**
  - نگهداری انبار و ثبت را جدا کنید
  - حسابرسی دوره‌ای موجودی انجام دهید

## نکات مهم

### محدودیت‌ها:
- ❌ در شرکت‌های بسیار کوچک (کمتر از 5 نفر) اجرای کامل ممکن نیست
- ❌ نیاز به داده‌های کامل UserID و نوع وظایف دارد
- ❌ فقط تخلفات را شناسایی می‌کند، ریسک واقعی را ارزیابی نمی‌کند
- ❌ کنترل‌های جبرانی را در نظر نمی‌گیرد

### بهترین کاربردها:
- ✅ سازمان‌هایی با بیش از 10 کارمند
- ✅ سیستم‌های مالی که UserID ثبت می‌کنند
- ✅ فرآیندهای خرید و فروش
- ✅ مدیریت موجودی و دارایی
- ✅ فرآیندهای پرداخت و دریافت

### توصیه‌ها:
1. **این آزمون را به صورت منظم اجرا کنید** (حداقل فصلی یک بار)
2. **با مدیران بخش‌ها مشورت کنید** قبل از محدود کردن دسترسی‌ها
3. **کنترل‌های جبرانی را بررسی کنید** (مثلاً تایید مدیر، گزارش‌های منظم)
4. **آموزش دهید** به کارمندان در مورد اهمیت تفکیک وظایف
5. **مستندسازی کنید** تمام استثناها و دلایل آن‌ها را
6. **با آزمون‌های دیگر ترکیب کنید** برای تشخیص تقلب واقعی

### اقدامات پیشنهادی برای هر سطح:

**برای موارد بحرانی:**
- بازبینی فوری تمام تراکنش‌ها
- محدود کردن دسترسی‌ها در 24 ساعت
- تحقیق در مورد احتمال تقلب
- بازنگری کامل نقش کاربر

**برای موارد بااولویت بالا:**
- بررسی نمونه‌ای از تراکنش‌ها
- اضافه کردن کنترل‌های جبرانی
- برنامه‌ریزی برای تفکیک دسترسی‌ها

**برای موارد متوسط:**
- پایش مستمر
- گزارش‌های دوره‌ای
- آموزش و آگاهی‌سازی

## ارتباط با سایر آزمون‌ها

این آزمون باید با آزمون‌های زیر ترکیب شود برای تشخیص بهتر تقلب:

### آزمون‌های مکمل:
- **آزمون ثبت‌های دستی:** بررسی ثبت‌های دستی توسط کاربران با تخلف
- **آزمون تراکنش‌های تکراری:** تشخیص الگوهای مشکوک در تراکنش‌ها
- **آزمون آنومالی:** شناسایی تراکنش‌های غیرعادی از کاربران خاص
- **آزمون پرداخت به کارمندان:** بررسی پرداخت‌ها به کاربران مشکوک

### نحوه استفاده ترکیبی:
1. **ابتدا این آزمون را اجرا کنید** برای شناسایی کاربران پرخطر
2. **سپس آزمون‌های تراکنشی را فقط برای آن کاربران اجرا کنید**
3. **تطبیق نتایج** برای یافتن شواهد واقعی تقلب

### مثال کاربرد ترکیبی:
```
مرحله 1: آزمون تفکیک وظایف
         ↓ شناسایی کاربر U001 با تخلف بحرانی
         
مرحله 2: آزمون ثبت‌های دستی برای U001
         ↓ یافتن 50 ثبت دستی مشکوک
         
مرحله 3: آزمون تراکنش‌های تکراری
         ↓ کشف الگوی تکراری در مبالغ
         
نتیجه: شواهد قوی برای تحقیق تقلب
```

## مراجع و منابع

- **استانداردهای حسابرسی داخلی (IIA):** تفکیک وظایف به عنوان یک کنترل کلیدی
- **چارچوب COSO:** یکی از 5 مولفه اصلی کنترل داخلی
- **قانون Sarbanes-Oxley:** الزام به تفکیک وظایف در شرکت‌های بورسی
- **استاندارد حسابرسی 315:** درک نهاد و محیط آن و ارزیابی ریسک‌های اشتباه با اهمیت
