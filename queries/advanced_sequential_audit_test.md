# مستندات آزمون تسلسل و ترتیب تراکنش‌ها

## نام آزمون
**آزمون ترتیب متوالی تراکنش‌ها** (Advanced Sequential Audit Test)

## هدف و کاربرد در حسابرسی

### چرا از این آزمون استفاده می‌کنیم؟
در سیستم‌های حسابداری، تراکنش‌ها معمولاً با شماره‌های متوالی ثبت می‌شوند. شکاف یا جهش در این شماره‌ها می‌تواند نشانه‌ای از:
- **حذف تراکنش:** تراکنش‌ها پس از ثبت حذف شده‌اند
- **دستکاری در سیستم:** تغییر یا پاک کردن سوابق
- **خطای سیستمی:** مشکلات فنی در شماره‌گذاری
- **تقلب:** حذف عمدی اسناد برای پنهان کردن فعالیت‌های غیرمجاز

**در حسابرسی از این آزمون برای:**
- **تایید تمامیت تراکنش‌ها:** اطمینان از ثبت کامل تمام تراکنش‌ها
- **کشف تراکنش‌های حذف شده:** یافتن شماره‌های گم شده
- **شناسایی دستکاری در سوابق:** تشخیص تغییرات غیرمجاز
- **ارزیابی کنترل‌های داخلی:** بررسی کارایی سیستم شماره‌گذاری

### کاربردهای عملی:
- بررسی تسلسل فاکتورهای فروش
- کنترل شماره چک‌های صادره
- تایید شماره سفارشات خرید
- بررسی سریال رسیدهای پرداخت

## پارامترهای ورودی

این آزمون پارامتر ورودی ندارد و به صورت خودکار تمام تراکنش‌ها را بررسی می‌کند.

## ستون‌های خروجی

### 1. SequenceNumber (شماره ترتیب)
- شماره ترتیب تراکنشی که قبل از شکاف قرار دارد

### 2. ExpectedNext (شماره مورد انتظار)
- شماره‌ای که به صورت طبیعی بعد از شماره فعلی انتظار می‌رود
- محاسبه: شماره فعلی + 1

### 3. ActualNext (شماره واقعی)
- شماره واقعی تراکنش بعدی در سیستم

### 4. GapSize (اندازه شکاف)
- تعداد شماره‌های گم شده
- محاسبه: شماره واقعی - شماره فعلی - 1

### 5. Date (تاریخ)
- تاریخ تراکنشی که قبل از شکاف قرار دارد
- کمک به شناسایی زمان وقوع مشکل

### 6. GapType (نوع شکاف)
- طبقه‌بندی شکاف بر اساس اندازه:
  - `یک شماره گم شده`: فقط یک شماره از دست رفته
  - `شکاف کوچک`: 2-4 شماره گم شده
  - `شکاف متوسط`: 5-9 شماره گم شده
  - `شکاف بزرگ`: 10 یا بیشتر شماره گم شده

## نحوه انجام آزمون

### مراحل اجرا:

1. **دریافت داده‌ها:**
   - تمام تراکنش‌ها از پایگاه داده خوانده می‌شوند
   - فقط تراکنش‌هایی که دارای شماره ترتیب هستند در نظر گرفته می‌شوند

2. **استخراج شماره‌های ترتیب:**
   - برای هر تراکنش:
     - شماره ترتیب (SequenceNumber)
     - تاریخ تراکنش

3. **مرتب‌سازی:**
   - تراکنش‌ها بر اساس شماره ترتیب (از کوچک به بزرگ) مرتب می‌شوند

4. **شناسایی شکاف‌ها:**
   - برای هر جفت متوالی:
     ```
     اگر (شماره بعدی ≠ شماره فعلی + 1)
         شکاف شناسایی شده
         اندازه شکاف = شماره بعدی - شماره فعلی - 1
     ```

5. **طبقه‌بندی شکاف‌ها:**
   - بر اساس اندازه، نوع شکاف تعیین می‌شود:
     - اندازه = 1 → "یک شماره گم شده"
     - اندازه 2-4 → "شکاف کوچک"
     - اندازه 5-9 → "شکاف متوسط"
     - اندازه ≥ 10 → "شکاف بزرگ"

6. **ثبت نتایج:**
   - هر شکاف با تمام اطلاعات مربوطه ثبت می‌شود

## تفسیر نتایج

### انواع شکاف‌ها:

#### یک شماره گم شده - نیاز به بررسی
- **ویژگی‌ها:**
  - فقط یک تراکنش از دست رفته
- **احتمالات:**
  - خطای ورود اطلاعات
  - تراکنش لغو شده
  - حذف تصادفی
- **سطح ریسک:** متوسط
- **اقدام:** بررسی علت و پیدا کردن سند مربوطه

#### شکاف کوچک (2-4 شماره) - مشکوک
- **ویژگی‌ها:**
  - چند تراکنش متوالی گم شده
- **احتمالات:**
  - حذف عمدی
  - خرابی سیستم
  - تراکنش‌های باطل شده
- **سطح ریسک:** بالا
- **اقدام:** تحقیق دقیق و یافتن همه تراکنش‌های گم شده

#### شکاف متوسط (5-9 شماره) - بسیار مشکوک
- **ویژگی‌ها:**
  - گم شدن تعداد قابل توجهی تراکنش
- **احتمالات:**
  - دستکاری عمدی در سیستم
  - حذف دسته‌ای تراکنش‌ها
  - تقلب سیستماتیک
- **سطح ریسک:** بسیار بالا
- **اقدام:** تحقیق فوری و گسترده

#### شکاف بزرگ (10+ شماره) - بحرانی
- **ویژگی‌ها:**
  - شکاف بسیار بزرگ در شماره‌ها
- **احتمالات:**
  - تغییر سیستم حسابداری
  - دستکاری گسترده
  - خطای جدی در شماره‌گذاری
  - استفاده از بلوک‌های شماره مجزا
- **سطح ریسک:** بحرانی
- **اقدام:** بررسی فوری مدیریت و سیستم

### علائم خطر (Red Flags):

1. **شکاف‌های مکرر در یک بازه زمانی:**
   - چند شکاف در مدت کوتاه
   - نشانه مشکل سیستماتیک یا تقلب

2. **شکاف در انتهای دوره مالی:**
   - شکاف نزدیک به پایان ماه/سال
   - احتمال دستکاری در گزارش‌های مالی

3. **الگوی منظم شکاف‌ها:**
   - شکاف‌های با اندازه مشابه
   - احتمال حذف عمدی نوع خاصی از تراکنش

4. **شکاف پس از تراکنش‌های بزرگ:**
   - گم شدن شماره‌ها بعد از تراکنش‌های پرمبلغ
   - نشانه پنهان کردن تراکنش‌های مرتبط

## مثال عملی

### سناریو:
بررسی فاکتورهای فروش یک فروشگاه زنجیره‌ای

### نتیجه نمونه:
```
شماره ترتیب | مورد انتظار | شماره واقعی | اندازه شکاف | تاریخ      | نوع شکاف
1001         | 1002        | 1002         | 0            | 2024-01-15 | بدون شکاف
1002         | 1003        | 1005         | 2            | 2024-01-15 | شکاف کوچک
1010         | 1011        | 1012         | 1            | 2024-01-16 | یک شماره گم شده
1025         | 1026        | 1035         | 9            | 2024-01-20 | شکاف متوسط
1050         | 1051        | 1075         | 24           | 2024-01-31 | شکاف بزرگ
```

### تحلیل:

1. **شماره 1002-1005:**
   - 2 فاکتور گم شده (1003 و 1004)
   - تاریخ: 2024-01-15
   - **بررسی:** آیا این فاکتورها لغو شده‌اند؟

2. **شماره 1010-1012:**
   - 1 فاکتور گم شده (1011)
   - احتمال خطای ورود اطلاعات
   - **بررسی:** جستجوی فاکتور 1011

3. **شماره 1025-1035:**
   - 9 فاکتور گم شده - بسیار مشکوک
   - نیاز به تحقیق فوری
   - **بررسی:** علت حذف این تعداد فاکتور چیست؟

4. **شماره 1050-1075:**
   - 24 فاکتور گم شده - بحرانی
   - پایان ماه (31 ژانویه)
   - **بررسی فوری:** احتمال دستکاری در گزارش ماهانه

### اقدامات پیشنهادی:
1. بازیابی نسخه پشتیبان فاکتورهای گم شده
2. مصاحبه با کارکنان مسئول ثبت
3. بررسی لاگ‌های سیستم
4. تطبیق با رسیدهای فروش فیزیکی

## نکات مهم

### محدودیت‌ها:
- ❌ نمی‌تواند علت شکاف را مشخص کند (فقط شناسایی می‌کند)
- ❌ در سیستم‌هایی که شماره‌گذاری متوالی ندارند کاربرد ندارد
- ❌ ممکن است شکاف‌های قانونی (مثل تراکنش‌های لغو شده) را هم نشان دهد

### بهترین کاربردها:
- ✅ فاکتورهای فروش
- ✅ چک‌های صادره
- ✅ سفارشات خرید
- ✅ رسیدهای دریافت/پرداخت
- ✅ سندهای حسابداری

### توصیه‌ها:
1. **شکاف‌های کوچک:** همیشه علت را مستند کنید
2. **شکاف‌های بزرگ:** بررسی فوری و تحقیق جامع
3. **ثبت دلایل:** برای هر شکاف، دلیل قانونی یا توضیح ثبت شود
4. **پیگیری منظم:** این آزمون را به صورت دوره‌ای اجرا کنید

### اقدامات پیشگیرانه:
- استفاده از سیستم‌های خودکار شماره‌گذاری
- غیرفعال کردن قابلیت حذف تراکنش‌ها
- نگهداری لاگ کامل تمام تغییرات
- کنترل دسترسی سخت‌گیرانه برای حذف

## ارتباط با سایر آزمون‌ها

- **آزمون تراکنش‌های تکراری:** برای بررسی شماره‌های تکراری
- **آزمون ثبت‌های دستی:** شکاف‌ها ممکن است ناشی از ثبت‌های دستی باشد
- **آزمون تراکنش‌های پایان دوره:** شکاف‌ها در پایان دوره مشکوک‌تر هستند
- **آزمون ثبت‌های بدون مدرک:** شماره‌های گم شده ممکن است بدون مدرک باشند

## بررسی شکاف‌های قانونی

### دلایل مجاز برای شکاف:
1. **تراکنش‌های لغو شده:**
   - شماره تخصیص یافته اما لغو شده
   - باید مدرک لغو موجود باشد

2. **تراکنش‌های باطل شده:**
   - اشتباه در ورود اطلاعات
   - باید سند ابطال موجود باشد

3. **بلوک‌های شماره رزرو شده:**
   - شماره‌ها برای کاربرد خاص رزرو شده
   - باید مستندسازی شود

4. **تغییر سیستم:**
   - تغییر نرم‌افزار یا روش شماره‌گذاری
   - باید تاریخدار و ثبت شده باشد

### چک‌لیست بررسی:
- [ ] آیا شکاف ثبت شده است؟
- [ ] آیا دلیل شکاف مشخص است؟
- [ ] آیا مدرک لغو/ابطال موجود است؟
- [ ] آیا تایید مدیریت وجود دارد؟
- [ ] آیا در لاگ سیستم ثبت شده است؟

اگر پاسخ به هر یک از سوالات "خیر" است، شکاف نیاز به تحقیق بیشتر دارد.
