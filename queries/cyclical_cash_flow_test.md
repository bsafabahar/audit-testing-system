# مستندات آزمون الگوی دوره‌ای جریان نقدی

## نام آزمون
**آزمون الگوی دوره‌ای جریان نقدی** (Cyclical Cash Flow Pattern Test)

## هدف و کاربرد در حسابرسی

### چرا از این آزمون استفاده می‌کنیم؟
جریان نقدی در بسیاری از کسب‌وکارها از الگوهای طبیعی و دوره‌ای پیروی می‌کند. این الگوها ممکن است به دلیل فصلی بودن کسب‌وکار، چرخه‌های پرداخت، یا الگوهای خرید مشتریان باشد. اما زمانی که الگوهای غیرطبیعی یا دستکاری شده وجود دارد، می‌تواند نشانه‌ای از مشکلات مالی، مدیریت سود، یا حتی تقلب باشد.

**در حسابرسی از این آزمون برای:**
- **کشف دستکاری در جریان نقدی:** شناسایی تغییرات مصنوعی برای بهبود ظاهری وضعیت نقدینگی
- **تشخیص مدیریت سود:** الگوهای غیرعادی که برای تاثیر بر صورت‌های مالی ایجاد شده‌اند
- **شناسایی مشکلات نقدینگی:** نوسانات شدید که نشان‌دهنده مشکلات ساختاری است
- **پیش‌بینی بحران مالی:** الگوهای غیرعادی که می‌توانند هشداردهنده مشکلات آینده باشند

### کاربردهای عملی:
- بررسی تطابق جریان نقدی با چرخه کسب‌وکار
- تشخیص window dressing (آرایش صورت‌های مالی)
- شناسایی الگوهای مشکوک در پایان دوره مالی
- ارزیابی سلامت مالی و پایداری جریان نقدی

## پارامترهای ورودی

### 1. دوره زمانی (periodDays)
- **نوع:** عدد (Number)
- **مقدار پیش‌فرض:** 30 روز
- **توضیح:** طول دوره زمانی برای گروه‌بندی تراکنش‌ها
- **کاربرد:** 
  - تعیین می‌کند که داده‌ها در چه بازه‌هایی تجمیع شوند
  - با 30 روز، تحلیل ماهانه انجام می‌شود
- **راهنما:**
  - 7 روز: تحلیل هفتگی (برای کسب‌وکارهای با گردش نقد بالا)
  - 30 روز: تحلیل ماهانه (استاندارد)
  - 90 روز: تحلیل فصلی (برای کسب‌وکارهای فصلی)
- **مثال:** برای کسب‌وکار خرده‌فروشی با فروش روزانه بالا، 7 روز مناسب است

### 2. آستانه همبستگی (correlationThreshold)
- **نوع:** عدد (Number)
- **مقدار پیش‌فرض:** 0.7
- **توضیح:** حد آستانه برای تشخیص همبستگی بین الگوها
- **مفهوم:**
  - مقدار بین 0 تا 1
  - 0.7 یعنی همبستگی 70٪ بین الگوها
  - برای تشخیص الگوهای تکراری استفاده می‌شود
- **راهنما:**
  - مقادیر بالاتر (0.8-0.9): فقط الگوهای بسیار مشابه
  - مقادیر پایین‌تر (0.5-0.6): حساسیت بیشتر به تغییرات
- **توجه:** این پارامتر در نسخه فعلی کد برای تحلیل‌های پیشرفته‌تر آماده شده است

## ستون‌های خروجی

خروجی این آزمون یک جدول است که برای هر دوره زمانی اطلاعات زیر را نشان می‌دهد:

### 1. Period (دوره)
- دوره زمانی به فرمت YYYY-MM (مثلاً 2024-01)
- نشان‌دهنده ماه و سال مورد تحلیل

### 2. CashInflow (ورود نقدی)
- مجموع ورودی‌های نقدی در آن دوره
- شامل فروش، دریافت‌ها، و سایر ورودی‌ها
- واحد: واحد پول (ریال، دلار و غیره)

### 3. CashOutflow (خروج نقدی)
- مجموع خروجی‌های نقدی در آن دوره
- شامل خریدها، پرداخت‌ها، و سایر خروجی‌ها
- واحد: واحد پول

### 4. NetCashFlow (خالص جریان نقدی)
- تفاضل بین ورودی و خروجی نقدی
- فرمول: ورود نقدی - خروج نقدی
- مقدار مثبت: جریان نقدی مثبت (ورودی بیشتر از خروجی)
- مقدار منفی: جریان نقدی منفی (خروجی بیشتر از ورودی)

### 5. MovingAverage (میانگین متحرک)
- میانگین جریان نقدی خالص برای 3 دوره اخیر
- استفاده برای هموارسازی نوسانات کوتاه‌مدت
- کمک به تشخیص روند واقعی

### 6. Deviation (انحراف از میانگین)
- درصد انحراف جریان نقدی واقعی از میانگین متحرک
- فرمول: ((واقعی - میانگین) / میانگین) × 100
- مقدار مثبت: بالاتر از انتظار
- مقدار منفی: پایین‌تر از انتظار

### 7. CyclicalPattern (الگوی دوره‌ای)
- **عادی:** انحراف کمتر از 50٪ (در محدوده طبیعی)
- **اوج دوره‌ای:** انحراف بیشتر از +50٪ (افزایش غیرعادی)
- **فرود دوره‌ای:** انحراف کمتر از -50٪ (کاهش غیرعادی)

## نحوه انجام آزمون

### مراحل اجرا:
1. **استخراج داده‌ها:** تمام تراکنش‌های مالی از پایگاه داده خوانده می‌شوند

2. **گروه‌بندی بر اساس دوره:**
   - تراکنش‌ها بر اساس تاریخ به دوره‌های ماهانه تقسیم می‌شوند
   - برای هر دوره، ورودی و خروجی نقدی جمع می‌شود

3. **محاسبه جریان نقدی:**
   - **ورود نقدی:** مجموع ستون Credit (بستانکار)
   - **خروج نقدی:** مجموع ستون Debit (بدهکار)
   - **خالص جریان:** ورودی - خروجی

4. **محاسبه میانگین متحرک:**
   - برای هر دوره، میانگین 3 دوره اخیر محاسبه می‌شود
   - این عمل نوسانات کوتاه‌مدت را هموار می‌کند

5. **محاسبه انحراف:**
   - برای هر دوره: ((جریان واقعی - میانگین) / میانگین) × 100
   - نشان‌دهنده چقدر از الگوی عادی فاصله گرفته است

6. **تشخیص الگو:**
   - اگر انحراف > +50٪ ➡️ اوج دوره‌ای
   - اگر انحراف < -50٪ ➡️ فرود دوره‌ای
   - در غیر این صورت ➡️ عادی

7. **فیلتر کردن:** فقط دوره‌هایی که داده کافی دارند (حداقل 3 دوره) نمایش داده می‌شوند

## تفسیر نتایج

### نتایج عادی (طبیعی):
- **الگوی "عادی" برای اکثر دوره‌ها**
- انحراف در محدوده -50٪ تا +50٪
- تغییرات تدریجی و قابل پیش‌بینی
- جریان نقدی متناسب با چرخه کسب‌وکار

### نتایج مشکوک:

#### اوج دوره‌ای (انحراف > +50٪):
**علل طبیعی:**
- فصل اوج فروش (مثلاً نوروز برای خرده‌فروشی)
- دریافت پرداخت بزرگ از مشتری
- فروش دارایی
- دریافت تسهیلات بانکی

**علل مشکوک:**
- **Window Dressing:** افزایش مصنوعی نقدینگی قبل از پایان دوره مالی
- **پیش‌فروش غیرعادی:** فروش کالای دوره بعد در دوره فعلی
- **دریافت زودهنگام:** فشار به مشتریان برای پرداخت زودتر
- **تراکنش‌های جعلی:** ثبت فروش ساختگی

#### فرود دوره‌ای (انحراف < -50٪):
**علل طبیعی:**
- فصل کم‌کاری کسب‌وکار
- پرداخت بزرگ (مثلاً خرید دارایی، بازپرداخت وام)
- تعمیرات اساسی

**علل مشکوک:**
- **پنهان کردن درآمد:** عدم ثبت فروش‌ها برای فرار مالیاتی
- **تاخیر مصنوعی:** به تاخیر انداختن دریافت‌ها به دوره بعد
- **مشکلات نقدینگی:** نتوانستن در جمع‌آوری مطالبات
- **برداشت غیرمجاز:** خروج وجه برای اهداف شخصی

### الگوهای خطرناک:

1. **نوسان شدید متناوب:**
   - یک ماه اوج، ماه بعد فرود، و این الگو تکرار می‌شود
   - احتمال: جابجایی درآمد بین دوره‌ها

2. **اوج در پایان سال مالی:**
   - افزایش ناگهانی جریان نقدی در آخرین ماه سال
   - احتمال: تلاش برای بهبود ظاهری صورت‌های مالی

3. **روند نزولی مداوم:**
   - کاهش پیوسته جریان نقدی در چند ماه متوالی
   - احتمال: مشکلات اساسی در کسب‌وکار

4. **عدم تطابق با فصلی بودن:**
   - کسب‌وکار فصلی است اما الگوی جریان نقدی فصلی نیست
   - احتمال: دستکاری برای پنهان کردن الگوی واقعی

## مثال عملی

### سناریو:
یک شرکت خرده‌فروشی با فصلی بودن طبیعی (فروش بیشتر در نوروز و محرم).

### تنظیمات:
- periodDays: 30
- correlationThreshold: 0.7

### نتیجه نمونه:
```
دوره    | ورود نقدی  | خروج نقدی  | خالص جریان | میانگین متحرک | انحراف  | الگوی دوره‌ای
2023-09 | 1,500,000  | 1,200,000  | 300,000    | 280,000       | +7.1%   | عادی
2023-10 | 1,600,000  | 1,250,000  | 350,000    | 310,000       | +12.9%  | عادی
2023-11 | 1,800,000  | 1,300,000  | 500,000    | 350,000       | +42.8%  | عادی
2023-12 | 4,500,000  | 1,400,000  | 3,100,000  | 1,316,667     | +135%   | اوج دوره‌ای ⚠️
2024-01 | 1,200,000  | 1,100,000  | 100,000    | 1,233,333     | -91.8%  | فرود دوره‌ای ⚠️
2024-02 | 1,550,000  | 1,220,000  | 330,000    | 1,176,667     | -71.9%  | فرود دوره‌ای ⚠️
```

### تحلیل:

**دوره 2023-12 (اوج دوره‌ای):**
- جریان نقدی 3,100,000 (بیشتر از 135٪ میانگین)
- **سوالات حسابرسی:**
  - آیا این افزایش طبیعی است؟ (شاید فصل خرید عید)
  - آیا فروش‌های دوره بعد را پیش‌فروش کرده‌اند؟
  - آیا تراکنش‌های ساختگی وجود دارد؟
- **اقدامات:**
  - بررسی فاکتورهای فروش دسامبر
  - مقایسه با سال‌های قبل
  - تطبیق با موجودی کالا

**دوره‌های 2024-01 و 2024-02 (فرود دوره‌ای):**
- جریان نقدی به شدت کاهش یافته
- **سوالات حسابرسی:**
  - آیا نتیجه پیش‌فروش در دسامبر است؟
  - آیا مشکل نقدینگی وجود دارد؟
  - آیا فروش‌ها به تاخیر افتاده‌اند؟
- **اقدامات:**
  - بررسی دریافتنی‌ها
  - مقایسه فروش فیزیکی با فروش ثبت شده
  - بررسی شکایات مشتریان

**نتیجه‌گیری:**
الگوی مشکوک window dressing - افزایش مصنوعی جریان نقدی در پایان سال و سپس کاهش شدید. نیاز به تحقیق بیشتر.

## نکات مهم

### محدودیت‌ها:
- ❌ برای کسب‌وکارهای نوپا (کمتر از 6 ماه فعالیت) قابل اعتماد نیست
- ❌ تراکنش‌های با حجم بسیار کم نتیجه معناداری ندارد
- ❌ کسب‌وکارهای با رویدادهای یک‌باره بزرگ (مثل پروژه‌ای) نیاز به تفسیر خاص دارند
- ❌ تنها الگوها را نشان می‌دهد، دلیل آن‌ها را مشخص نمی‌کند

### بهترین کاربردها:
- ✅ کسب‌وکارهای با حداقل 6-12 ماه سابقه
- ✅ شرکت‌هایی با تراکنش‌های منظم
- ✅ کسب‌وکارهای خرده‌فروشی و خدماتی
- ✅ شناسایی الگوهای فصلی
- ✅ مقایسه عملکرد دوره‌ها

### توصیه‌ها:
1. **همیشه با دانش کسب‌وکار تفسیر کنید** - الگوی غیرعادی لزوماً تقلب نیست
2. **با سال‌های قبل مقایسه کنید** - آیا الگوی مشابهی وجود داشته؟
3. **علل طبیعی را بررسی کنید** - رویدادها، فصول، قراردادهای بزرگ
4. **با مدیریت مشورت کنید** - توضیح آن‌ها را برای نوسانات بپرسید
5. **آزمون‌های تکمیلی انجام دهید** - برای تایید یا رد مشکوک بودن

### نکات تفسیر:
- دوره‌های اول و آخر ممکن است کامل نباشند
- تغییرات سیاست‌های حسابداری می‌تواند الگو ایجاد کند
- ادغام یا تجزیه واحدهای کسب‌وکار تاثیرگذار است
- تغییرات نرخ ارز برای شرکت‌های بین‌المللی مهم است

## ارتباط با سایر آزمون‌ها

### آزمون‌های مکمل:

**1. آزمون الگوی دوره‌ای فروش:**
- بررسی هماهنگی جریان نقدی با فروش
- اگر فروش افزایش یافته اما جریان نقدی خیر، مشکل در دریافتنی‌هاست

**2. آزمون الگوی دوره‌ای موجودی:**
- تطابق خریدهای نقدی با تغییرات موجودی
- کمک به تشخیص خریدهای غیرضروری یا سرقت

**3. آزمون موجودی معوق:**
- اگر موجودی زیاد و جریان نقدی ضعیف است، مشکل در فروش

**4. آزمون بررسی بانکی:**
- تطبیق جریان نقدی با تراکنش‌های بانکی واقعی
- تایید صحت داده‌ها

**5. آزمون مطالبات مشکوک:**
- جریان نقدی کم می‌تواند به دلیل مطالبات وصول نشده باشد

### نحوه استفاده ترکیبی:

**سناریوی تحلیل جامع نقدینگی:**
```
مرحله 1: آزمون الگوی دوره‌ای جریان نقدی
         ↓ شناسایی اوج غیرعادی در دسامبر
         
مرحله 2: آزمون الگوی دوره‌ای فروش
         ↓ فروش هم در دسامبر اوج دارد، اما نه به این میزان
         
مرحله 3: آزمون بررسی بانکی
         ↓ بررسی واریزهای واقعی در حساب بانک
         
مرحله 4: بررسی دریافتنی‌ها
         ↓ افزایش غیرعادی در دریافتنی‌های ژانویه
         
نتیجه: احتمال پیش‌فروش یا فشار برای دریافت زودهنگام
```

## مراجع و منابع

- **استانداردهای حسابداری:** صورت جریان وجوه نقد (IAS 7)
- **تحلیل مالی:** نسبت‌های نقدینگی و جریان نقدی عملیاتی
- **تشخیص تقلب:** الگوهای غیرعادی در جریان نقدی به عنوان نشانه Red Flag
- **تحلیل سری‌های زمانی:** استفاده از میانگین متحرک برای تشخیص روند
