# مستندات آزمون انتقالات بدون تطبیق

## نام آزمون
**آزمون شناسایی انتقالات بانکی بدون تطبیق** (Unmatched Transfers Test)

## هدف و کاربرد در حسابرسی

### چرا از این آزمون استفاده می‌کنیم؟
انتقالات بین حساب‌ها باید در هر دو طرف ثبت شوند. انتقالات بدون تطبیق می‌توانند نشانه:
- **خطا در ثبت:** فراموشی ثبت یکی از دو طرف
- **تقلب:** ثبت جعلی انتقال در یک طرف
- **پولشویی:** انتقالات یک‌طرفه برای جابجایی وجه
- **دستکاری:** تغییر یا حذف یکی از طرفین

**در حسابرسی از این آزمون برای:**
- **تطبیق انتقالات:** اطمینان از ثبت دوطرفه
- **شناسایی خطاها:** یافتن انتقالات ناقص
- **کشف تقلب:** شناسایی انتقالات جعلی
- **تایید تراکنش‌ها:** بررسی صحت انتقالات

### کاربردهای عملی:
- تطبیق انتقالات بین‌شعب
- کنترل انتقالات بین‌حسابی
- بررسی انتقالات بانکی
- شناسایی اختلاف در ثبت‌ها

## پارامترهای ورودی

### 1. مبلغ تلورانس (toleranceAmount)
- **نوع:** عدد (Number)
- **مقدار پیش‌فرض:** 10
- **توضیح:** حداکثر اختلاف مجاز بین دو طرف انتقال
- **مفهوم:**
  - تفاوت‌های کوچک (تا این مبلغ) طبیعی تلقی می‌شوند
  - مثلاً کارمزد بانکی ممکن است باعث تفاوت جزئی شود
- **توصیه:** 10-100 بسته به دقت مورد نیاز

## ستون‌های خروجی

### 1. TransferID (شناسه انتقال)
- شناسه منحصر به فرد انتقال

### 2. TransferDate (تاریخ انتقال)
- تاریخ انجام انتقال

### 3. FromAccount (از حساب)
- شماره حساب مبدا

### 4. ToAccount (به حساب)
- شماره حساب مقصد

### 5. Amount (مبلغ)
- مبلغ انتقال

### 6. MatchStatus (وضعیت تطبیق)
- وضعیت مطابقت:
  - `بدون تطبیق ورودی`: انتقال خروجی ثبت شده اما ورودی متناظر ندارد
  - `اختلاف مبلغ`: هر دو طرف ثبت شده اما مبالغ متفاوت است

### 7. DaysSinceTransfer (روزهای از انتقال)
- تعداد روزهایی که از انتقال گذشته و هنوز تطبیق نشده

## نحوه انجام آزمون

### مراحل اجرا:

1. **دریافت داده‌ها و دسته‌بندی:**
   - انتقالات خروجی (Outgoing) در یک گروه
   - انتقالات ورودی (Incoming) در گروه دیگر

2. **بررسی تطبیق:**
   - برای هر انتقال خروجی:
     - جستجوی انتقال ورودی با همان TransferID
     - اگر پیدا نشد → "بدون تطبیق ورودی"
     - اگر پیدا شد، مقایسه مبالغ:
       - اگر اختلاف > تلورانس → "اختلاف مبلغ"

3. **محاسبه روزهای معلق:**
   - تاریخ امروز - تاریخ انتقال

4. **مرتب‌سازی:**
   - بر اساس روزهای معلق (قدیمی‌ترین اول)

## تفسیر نتایج

### وضعیت‌های تطبیق:

#### بدون تطبیق ورودی - مشکوک
- انتقال خروجی ثبت شده اما ورودی متناظر وجود ندارد
- **احتمالات:**
  - انتقال هنوز در حساب مقصد ثبت نشده
  - خطا در ثبت
  - انتقال جعلی
- **سطح ریسک:** بالا (خصوصاً اگر قدیمی باشد)

#### اختلاف مبلغ - نیاز به بررسی
- هر دو طرف ثبت شده اما مبالغ متفاوت
- **احتمالات:**
  - کارمزد بانکی
  - خطا در ثبت مبلغ
  - دستکاری
- **سطح ریسک:** متوسط تا بالا

### بازه زمانی:

- **1-7 روز:** طبیعی (ممکن است تاخیر بانکی باشد)
- **7-30 روز:** نیاز به پیگیری
- **30+ روز:** مشکوک - تحقیق فوری

## مثال عملی

### سناریو:
بررسی انتقالات بین شعب یک بانک

### تنظیمات:
- toleranceAmount: 10

### نتیجه نمونه:
```
شناسه  | تاریخ      | از حساب | به حساب | مبلغ        | وضعیت              | روزها
TR-001 | 2024-01-15 | 1001    | 2001    | 50,000,000  | بدون تطبیق ورودی  | 90
TR-002 | 2024-02-20 | 1002    | 2002    | 30,000,000  | اختلاف مبلغ        | 45
TR-003 | 2024-03-10 | 1003    | 2003    | 15,000,000  | بدون تطبیق ورودی  | 25
```

### تحلیل:
1. **TR-001 (90 روز):** بسیار مشکوک - تحقیق فوری
2. **TR-002:** بررسی دلیل اختلاف (کارمزد یا خطا؟)
3. **TR-003:** پیگیری با شعبه مقصد

## نکات مهم

### محدودیت‌ها:
- ❌ نیاز به TransferID یکسان در هر دو طرف
- ❌ تاخیرهای طبیعی بانکی ممکن است false positive ایجاد کند

### توصیه‌ها:
1. انتقالات بالای 30 روز را فوراً بررسی کنید
2. تلورانس را بر اساس خط‌مشی بانکی تنظیم کنید
3. با بخش IT برای رفع مشکلات سیستمی هماهنگ کنید

## ارتباط با سایر آزمون‌ها
- **آزمون تطبیق بانکی:** تکمیل‌کننده برای تطبیق کلی
- **آزمون تراکنش‌های تکراری:** ممکن است دلیل تطبیق نشدن باشد
