# مستندات آزمون نام‌های تکراری

## نام آزمون
**آزمون شناسایی نام‌های مشابه** (Duplicate Vendor/Customer Names - Fuzzy Matching)

## هدف و کاربرد در حسابرسی

### چرا از این آزمون استفاده می‌کنیم؟
در بسیاری از موارد تقلب یا خطا، یک فروشنده یا مشتری ممکن است با نام‌های بسیار مشابه اما نه کاملاً یکسان در سیستم ثبت شود. این موضوع می‌تواند نشانه‌ای از:
- **تقلب:** ایجاد فروشندگان جعلی با نام‌های مشابه برای پنهان کردن پرداخت‌های غیرمجاز
- **خطای انسانی:** ثبت تکراری یک شخص/شرکت با املای متفاوت
- **دور زدن کنترل‌ها:** ایجاد حساب‌های مشابه برای دور زدن محدودیت‌های سیستمی

**در حسابرسی از این آزمون برای:**
- شناسایی حساب‌های تکراری یا مشابه
- کشف فروشندگان/مشتریان جعلی
- بهبود کیفیت داده‌ها
- یافتن پرداخت‌های تقسیم‌شده برای دور زدن حد مجاز

### کاربردهای عملی:
- بررسی لیست فروشندگان
- تحلیل پایگاه مشتریان
- شناسایی کارمندان تکراری (کارمندان شبح)
- کنترل حساب‌های بانکی

## پارامترهای ورودی

### 1. آستانه شباهت (similarityThreshold)
- **نوع:** عدد (Number)
- **مقدار پیش‌فرض:** 80
- **محدوده مجاز:** 0 تا 100
- **توضیح:** حداقل درصد شباهت بین دو نام برای شناسایی به عنوان مشابه
- **مفهوم:**
  - 100: فقط نام‌های کاملاً یکسان
  - 90-99: نام‌های بسیار مشابه (مثلاً املای مختلف)
  - 80-89: نام‌های مشابه (تفاوت‌های جزئی)
  - کمتر از 80: حساسیت بیشتر، احتمال false positive بالاتر
- **توصیه:** برای شروع از 80 استفاده کنید، سپس بر اساس نتایج تنظیم کنید

### 2. محدودیت تعداد (limit)
- **نوع:** عدد صحیح (Integer)
- **مقدار پیش‌فرض:** 100
- **توضیح:** حداکثر تعداد جفت‌های مشابه که در خروجی نمایش داده شود
- **کاربرد:** برای جلوگیری از خروجی بیش از حد بزرگ
- **توصیه:** اگر خروجی کم است، می‌توانید این مقدار را افزایش دهید

## ستون‌های خروجی

### 1. AccountCode1 (کد حساب ۱)
- اولین کد حساب/نام در جفت مشابه

### 2. AccountCode2 (کد حساب ۲)
- دومین کد حساب/نام در جفت مشابه

### 3. SimilarityScore (امتیاز شباهت)
- درصد شباهت بین دو نام (0 تا 100)
- هر چه بالاتر باشد، شباهت بیشتر است

### 4. TransactionCount1 (تعداد تراکنش ۱)
- تعداد تراکنش‌های مربوط به حساب اول

### 5. TransactionCount2 (تعداد تراکنش ۲)
- تعداد تراکنش‌های مربوط به حساب دوم

### 6. TotalAmount1 (جمع مبلغ ۱)
- مجموع مبالغ تراکنش‌های حساب اول

### 7. TotalAmount2 (جمع مبلغ ۲)
- مجموع مبالغ تراکنش‌های حساب دوم

### 8. IsSuspicious (مشکوک)
- **true:** اگر یکی از حساب‌ها کمتر از 10 تراکنش داشته باشد
- **false:** هر دو حساب فعالیت قابل قبولی دارند
- حساب‌های با تراکنش کم مشکوک‌تر هستند

## نحوه انجام آزمون

### الگوریتم Levenshtein Distance:
این آزمون از الگوریتم Levenshtein برای محاسبه شباهت استفاده می‌کند:

1. **محاسبه فاصله:** تعداد تغییرات (اضافه، حذف، یا تعویض کاراکتر) لازم برای تبدیل یک رشته به رشته دیگر

2. **محاسبه درصد شباهت:**
   ```
   شباهت = (1 - فاصله / حداکثر طول) × 100
   ```

### مراحل اجرا:

1. **جمع‌آوری داده‌ها:**
   - تمام تراکنش‌ها از پایگاه داده خوانده می‌شوند
   - کدهای حساب منحصر به فرد شناسایی می‌شوند

2. **آمارگیری:**
   - برای هر کد حساب:
     - تعداد تراکنش‌ها شمارش می‌شود
     - مجموع مبالغ محاسبه می‌شود

3. **مقایسه جفت به جفت:**
   - هر کد حساب با تمام کدهای دیگر مقایسه می‌شود
   - نام‌ها به حروف کوچک تبدیل و فضاهای اضافی حذف می‌شوند
   - فاصله Levenshtein محاسبه می‌شود
   - درصد شباهت محاسبه می‌شود

4. **فیلتر کردن:**
   - فقط جفت‌هایی که شباهت آنها بیشتر از آستانه است انتخاب می‌شوند
   - جفت‌های کاملاً یکسان (100%) حذف می‌شوند

5. **تعیین مشکوک بودن:**
   - اگر یکی از حساب‌ها کمتر از 10 تراکنش داشته باشد ➡️ مشکوک

6. **مرتب‌سازی:**
   - نتایج بر اساس امتیاز شباهت (بالا به پایین) مرتب می‌شوند
   - تا حد تعیین شده (limit) نمایش داده می‌شوند

## تفسیر نتایج

### سطوح شباهت:

#### 95-99% - بسیار مشکوک
- احتمالاً خطای تایپی یا تکراری
- **مثال:**
  - "شرکت ABC" و "شرکت ABD"
  - "علی احمدی" و "علی احمدی " (با فاضله)
  - "Acme Corp" و "Acme Corp."

#### 85-94% - مشکوک
- تفاوت‌های جزئی در املا
- **مثال:**
  - "شرکت پارس" و "شرکت پرس"
  - "محمد رضایی" و "محمدرضایی"

#### 75-84% - نیاز به بررسی
- ممکن است مشابه یا متفاوت باشد
- **مثال:**
  - "شرکت صنایع فولاد" و "شرکت صنایع فلزی"

### علائم خطر (Red Flags):

1. **تراکنش کم + شباهت بالا:**
   - حساب جدید با نام مشابه به حساب موجود
   - احتمال ایجاد حساب جعلی

2. **مبالغ بزرگ + شباهت بالا:**
   - پرداخت‌های قابل توجه به حساب‌های مشابه
   - احتمال تقسیم فاکتور برای دور زدن کنترل‌ها

3. **الگوی منظم:**
   - چند جفت مشابه با امتیاز شباهت یکسان
   - احتمال تقلب سیستماتیک

## مثال عملی

### سناریو:
بررسی لیست فروشندگان یک شرکت ساختمانی

### تنظیمات:
- similarityThreshold: 85
- limit: 50

### نتیجه نمونه:
```
حساب 1              | حساب 2              | شباهت | تراکنش1 | تراکنش2 | مبلغ1      | مبلغ2      | مشکوک
شرکت ساختمانی پارس  | شرکت ساختمانی پرس   | 96%   | 45      | 3       | 500M       | 50M        | بله
احمد رضایی           | احمد رضائی          | 95%   | 20      | 18      | 200M       | 180M       | خیر
مهندسین مشاور آریا   | مهندسین مشاور آرین  | 88%   | 30      | 2       | 300M       | 20M        | بله
```

### تحلیل:
1. **ردیف اول:** بسیار مشکوک - حساب دوم جدید با نام تقریباً یکسان
2. **ردیف دوم:** احتمالاً خطای املایی - هر دو حساب فعال
3. **ردیف سوم:** مشکوک - حساب جدید با فعالیت کم

### اقدامات پیشنهادی:
1. بررسی مدارک ثبت فروشنده
2. تایید آدرس و شماره تماس
3. بررسی امضای مجوز پرداخت
4. ادغام حساب‌های تکراری

## نکات مهم

### محدودیت‌ها:
- ❌ برای نام‌های بسیار کوتاه (کمتر از 3 حرف) دقت پایین
- ❌ برای زبان‌های مختلف (فارسی و انگلیسی) باید جداگانه بررسی شود
- ❌ نمی‌تواند معنای کلمات را تشخیص دهد

### بهترین کاربردها:
- ✅ لیست فروشندگان
- ✅ پایگاه مشتریان
- ✅ فهرست کارکنان
- ✅ حساب‌های بانکی

### توصیه‌ها:
1. **تنظیم آستانه:** شروع با 80-85 و تنظیم بر اساس نتایج
2. **بررسی دستی:** همیشه نتایج را به صورت دستی بررسی کنید
3. **ترکیب با سایر آزمون‌ها:** از آزمون‌های آدرس یا شماره حساب بانکی استفاده کنید
4. **پیگیری موارد مشکوک:** برای موارد با تراکنش کم و شباهت بالا، بررسی عمیق‌تر انجام دهید

### اقدامات پیشگیرانه:
- استفاده از لیست کد یکتا برای فروشندگان
- اعتبارسنجی نام قبل از ثبت
- بررسی خودکار شباهت هنگام ایجاد حساب جدید
- آموزش کارکنان در خصوص ثبت صحیح اطلاعات

## ارتباط با سایر آزمون‌ها

- **آزمون تراکنش‌های تکراری:** برای تایید مشکوک بودن
- **آزمون کارمندان شبح:** در حوزه حقوق و دستمزد
- **آزمون فروشندگان جعلی:** برای شناسایی شرکت‌های کاغذی

## الگوریتم محاسبه شباهت

### Levenshtein Distance:
فاصله Levenshtein تعداد حداقل عملیات‌های زیر برای تبدیل رشته A به رشته B است:
- **درج** یک کاراکتر
- **حذف** یک کاراکتر
- **جایگزینی** یک کاراکتر

**مثال:**
- "کیتن" → "نشستن"
- درج 'ن' → "نکیتن"
- جایگزینی 'ک' با 'ش' → "نشیتن"
- جایگزینی 'ی' با 'س' → "نشستن"
- فاصله = 3

### محاسبه درصد:
```
شباهت = (1 - 3 / 6) × 100 = 50%
```
