<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ</title>
    <!-- Vazir Persian Font from official CDN -->
    <!-- This is the official repository for Vazir font: https://github.com/rastikerdar/vazir-font -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" type="text/css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazir', 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .content {
            padding: 40px 30px;
        }

        /* Progress Steps */
        .steps-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 50px;
            padding: 0 100px;
            position: relative;
        }

        .steps-container::before {
            content: '';
            position: absolute;
            top: 30px;
            right: 20%;
            left: 20%;
            height: 3px;
            background: #e9ecef;
            z-index: 0;
        }

        .step {
            text-align: center;
            position: relative;
            z-index: 1;
            flex: 1;
        }

        .step-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: 3px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .step.active .step-circle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.15);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .step.completed .step-circle {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .step-title {
            font-weight: bold;
            color: #666;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .step.active .step-title {
            color: #667eea;
            font-size: 1.2em;
        }

        /* Panel Sections */
        .panel {
            display: none;
            animation: fadeIn 0.5s;
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-right: 5px solid #667eea;
        }

        .panel-header h2 {
            color: #667eea;
            font-size: 1.9em;
            margin-bottom: 10px;
        }

        .panel-header p {
            color: #666;
            font-size: 1.1em;
        }

        /* Test Categories Grid */
        .test-categories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-category {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .test-category:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            margin: -10px -10px 10px -10px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .category-header:hover {
            background: #f8f9fa;
        }

        .category-title {
            color: #667eea;
            font-size: 1.2em;
            font-weight: bold;
        }

        .category-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .test-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .test-list.expanded {
            max-height: 1000px;
        }

        .test-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .test-item:hover {
            background: #e9ecef;
            transform: translateX(-3px);
        }

        .test-item.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.02);
        }

        .test-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .test-icon {
            font-size: 1.3em;
        }

        .test-name {
            flex: 1;
            font-size: 0.95em;
        }

        /* Selected Tests Summary */
        .selected-summary {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid #28a745;
            display: none;
        }

        .selected-summary.visible {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .selected-summary h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .selected-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.95em;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .tag .remove {
            cursor: pointer;
            font-weight: bold;
            padding: 0 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .tag .remove:hover {
            background: rgba(255,255,255,0.2);
        }

        /* View Toggle Buttons */
        .view-toggle {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .view-btn {
            padding: 12px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-btn:hover {
            background: #f0f0ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .view-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .view-content {
            display: none;
        }

        .view-content.active {
            display: block;
        }

        /* Upload Section */
        .upload-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .requirements-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .requirements-box h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .requirements-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .requirement-item {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            border-right: 3px solid #ffc107;
            font-size: 0.95em;
        }

        .requirement-item strong {
            color: #667eea;
        }

        .upload-box {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: #f8f9fa;
            transform: scale(1.01);
        }

        .upload-box input[type="file"] {
            display: none;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
            color: #667eea;
        }

        .upload-box h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .upload-box p {
            color: #666;
            font-size: 1.1em;
        }

        .file-status {
            margin-top: 20px;
        }

        .file-card {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .file-card .icon {
            font-size: 2.5em;
        }

        .file-info h4 {
            color: #155724;
            margin-bottom: 5px;
        }

        .file-info p {
            color: #155724;
            font-size: 0.95em;
        }

        /* Results Section */
        .results-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .test-result-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .test-result-card:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .result-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .result-title h3 {
            color: #667eea;
            font-size: 1.4em;
        }

        .result-status {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.95em;
        }

        .status-success {
            background: #28a745;
            color: white;
        }

        .status-error {
            background: #dc3545;
            color: white;
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-right: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .stat-value {
            color: #667eea;
            font-size: 1.8em;
            font-weight: bold;
        }

        .result-details {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        .result-table thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            text-align: right;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .result-table tbody td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
        }

        .result-table tbody tr:hover {
            background: #f8f9fa;
        }

        .result-table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .result-table tbody tr:nth-child(even):hover {
            background: #e9ecef;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #f5c6cb;
            margin: 10px 0;
        }

        /* Buttons */
        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(40, 167, 69, 0.4);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #667eea;
            font-size: 1.3em;
            font-weight: bold;
        }

        /* Alert */
        .alert {
            padding: 18px 25px;
            border-radius: 12px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.05em;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        /* Parameter Forms */
        .parameters-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid #dee2e6;
        }

        .parameters-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .parameter-form {
            display: grid;
            gap: 20px;
            margin-bottom: 20px;
        }

        .param-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .param-label {
            font-weight: 600;
            color: #333;
            font-size: 1.05em;
        }

        .param-required {
            color: #dc3545;
            margin-right: 5px;
        }

        .param-input,
        .param-select {
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            font-family: 'Vazir', 'Tahoma', sans-serif;
            transition: all 0.3s;
            background: white;
        }

        .param-input:focus,
        .param-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .param-checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
        }

        .param-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
        }

        .test-parameters-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .test-parameters-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .test-parameters-header h4 {
            color: #495057;
            font-size: 1.2em;
            margin: 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .steps-container {
                padding: 0 20px;
            }
            
            .test-categories {
                grid-template-columns: 1fr;
            }
            
            .result-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #667eea;
        }

        .expand-icon {
            transition: transform 0.3s;
        }

        .expanded .expand-icon {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Ø³ÛŒØ³ØªÙ… Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ</h1>
            <p>Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ Ø§Ø¬Ø±Ø§ÛŒ Û¶Û¹ Ø¢Ø²Ù…ÙˆÙ† Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ Ø¨Ø§ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</p>
        </div>

        <div class="content">
            <!-- Progress Steps -->
            <div class="steps-container">
                <div class="step active" id="step1">
                    <div class="step-circle">Û±</div>
                    <div class="step-title">Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-circle">Û²</div>
                    <div class="step-title">Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-circle">Û³</div>
                    <div class="step-title">Ù†ØªØ§ÛŒØ¬ Ùˆ Ú¯Ø²Ø§Ø±Ø´</div>
                </div>
            </div>

            <!-- Panel 1: Test Selection -->
            <div class="panel active" id="panel1">
                <div class="panel-header">
                    <h2>ğŸ“‹ Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„: Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø¨Ø±Ø³ÛŒ</h2>
                    <p>ÛŒÚ© ÛŒØ§ Ú†Ù†Ø¯ Ø¢Ø²Ù…ÙˆÙ† Ø±Ø§ Ø§Ø² Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. Ø¯Ø± Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯ØŒ ÙØ§ÛŒÙ„ Ø¯Ø§Ø¯Ù‡ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ø®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø±Ø¯.</p>
                </div>

                <div class="alert alert-info">
                    <span style="font-size: 1.5em;">ğŸ’¡</span>
                    <span>Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù‡Ø± Ø¯Ø³ØªÙ‡ØŒ Ø±ÙˆÛŒ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø³ØªÙ‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</span>
                </div>

                <!-- View Toggle -->
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('category')" id="viewBtnCategory">
                        <span>ğŸ“‚</span>
                        <span>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÙˆØ¶ÙˆØ¹ÛŒ</span>
                    </button>
                    <button class="view-btn" onclick="switchView('subsystem')" id="viewBtnSubsystem">
                        <span>ğŸ¦</span>
                        <span>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø²ÛŒØ±Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§</span>
                    </button>
                </div>

                <!-- Category View -->
                <div class="view-content active" id="categoryView">
                    <div class="test-categories">
                        {% for category_id, category in audit_tests.items() %}
                        <div class="test-category">
                            <div class="category-header" onclick="toggleCategory('{{ category_id }}')">
                                <span class="category-title">{{ category.name }}</span>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span class="category-count">{{ category.tests|length }}</span>
                                    <span class="expand-icon">â–¼</span>
                                </div>
                            </div>
                            <div class="test-list" id="list-{{ category_id }}">
                                {% for test in category.tests %}
                                <div class="test-item" id="item-{{ test.id }}" onclick="toggleTest('{{ test.id }}', '{{ test.name }}', '{{ test.icon }}')">
                                    <input type="checkbox" class="test-checkbox" id="check-{{ test.id }}" onclick="event.stopPropagation()">
                                    <span class="test-icon">{{ test.icon }}</span>
                                    <span class="test-name">{{ test.name }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Subsystem View -->
                <div class="view-content" id="subsystemView">
                    <div class="test-categories">
                        {% for subsystem_id, subsystem in subsystems.items() %}
                        <div class="test-category">
                            <div class="category-header" onclick="toggleCategory('sub-{{ subsystem_id }}')">
                                <span class="category-title">{{ subsystem.icon }} {{ subsystem.name }}</span>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span class="category-count">{{ subsystem.tests|length }}</span>
                                    <span class="expand-icon">â–¼</span>
                                </div>
                            </div>
                            <div class="test-list" id="list-sub-{{ subsystem_id }}">
                                {% for test in subsystem.tests %}
                                <div class="test-item" id="item-sub-{{ subsystem_id }}-{{ test.id }}" onclick="toggleTest('{{ test.id }}', '{{ test.name }}', '{{ test.icon }}')">
                                    <input type="checkbox" class="test-checkbox" id="check-sub-{{ subsystem_id }}-{{ test.id }}" onclick="event.stopPropagation()">
                                    <span class="test-icon">{{ test.icon }}</span>
                                    <span class="test-name">{{ test.name }}</span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="selected-summary" id="selectedSummary">
                    <h3>âœ… Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: <span id="selectedCount">0</span></h3>
                    <div class="selected-tags" id="selectedTags"></div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" id="btnNext1" onclick="goToStep2()" disabled>
                        <span>Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡</span>
                        <span>â¬…ï¸</span>
                    </button>
                </div>
            </div>

            <!-- Panel 2: Upload Data -->
            <div class="panel" id="panel2">
                <div class="panel-header">
                    <h2>ğŸ“¤ Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ…: Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„</h2>
                    <p>ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø­Ø§ÙˆÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.</p>
                </div>

                <div class="upload-section">
                    <div class="requirements-box">
                        <h4>ğŸ“Š Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¯Ø± ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„:</h4>
                        <div class="requirements-list">
                            <div class="requirement-item"><strong>ØªØ§Ø±ÛŒØ®:</strong> ØªØ§Ø±ÛŒØ® ØªØ±Ø§Ú©Ù†Ø´</div>
                            <div class="requirement-item"><strong>Ø´Ù…Ø§Ø±Ù‡ Ø³Ù†Ø¯:</strong> Ø´Ù…Ø§Ø±Ù‡ Ø³Ù†Ø¯</div>
                            <div class="requirement-item"><strong>Ú©Ø¯ Ø­Ø³Ø§Ø¨:</strong> Ú©Ø¯ Ø­Ø³Ø§Ø¨</div>
                            <div class="requirement-item"><strong>Ø¨Ø¯Ù‡Ú©Ø§Ø±:</strong> Ù…Ø¨Ù„Øº Ø¨Ø¯Ù‡Ú©Ø§Ø±</div>
                            <div class="requirement-item"><strong>Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±:</strong> Ù…Ø¨Ù„Øº Ø¨Ø³ØªØ§Ù†Ú©Ø§Ø±</div>
                            <div class="requirement-item"><strong>Ø´Ø±Ø­:</strong> Ø´Ø±Ø­ ØªØ±Ø§Ú©Ù†Ø´</div>
                        </div>
                    </div>

                    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
                        <input type="file" id="fileInput" accept=".xlsx,.xls" multiple onchange="uploadFiles()">
                        <div class="upload-icon">ğŸ“</div>
                        <h3>Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ú©Ø´ÛŒØ¯</h3>
                        <p>ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²: Excel (.xlsx, .xls)</p>
                        <p style="color: #667eea; margin-top: 5px;">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú†Ù†Ø¯ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ø§ Ù‡Ù… Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</p>
                    </div>

                    <div class="file-status" id="fileStatus"></div>
                </div>

                <!-- Parameters Section -->
                <div class="parameters-section" id="parametersSection" style="display: none;">
                    <h3>
                        <span>âš™ï¸</span>
                        <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†</span>
                    </h3>
                    <div id="parametersContainer"></div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="goToStep1()">
                        <span>ğŸ”™</span>
                        <span>Ø¨Ø§Ø²Ú¯Ø´Øª</span>
                    </button>
                    <button class="btn btn-success" id="btnRun" onclick="goToStep3()" disabled>
                        <span>Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</span>
                        <span>â–¶ï¸</span>
                    </button>
                </div>
            </div>

            <!-- Panel 3: Results -->
            <div class="panel" id="panel3">
                <div class="panel-header">
                    <h2>ğŸ“Š Ù…Ø±Ø­Ù„Ù‡ Ø³ÙˆÙ…: Ù†ØªØ§ÛŒØ¬ Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</h2>
                    <p>Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø´Ù…Ø§</p>
                </div>

                <div class="results-container" id="resultsContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§... Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯</p>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="resetAll()">
                        <span>ğŸ”„</span>
                        <span>Ø´Ø±ÙˆØ¹ Ù…Ø¬Ø¯Ø¯</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportAll()">
                        <span>Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ù…Ù‡ (Excel)</span>
                        <span>ğŸ’¾</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedTests = new Map();
        let uploadedRecords = 0;
        let testResults = [];

        function switchView(viewType) {
            // Update button states
            document.getElementById('viewBtnCategory').classList.remove('active');
            document.getElementById('viewBtnSubsystem').classList.remove('active');
            
            if (viewType === 'category') {
                document.getElementById('viewBtnCategory').classList.add('active');
                document.getElementById('categoryView').classList.add('active');
                document.getElementById('subsystemView').classList.remove('active');
            } else {
                document.getElementById('viewBtnSubsystem').classList.add('active');
                document.getElementById('categoryView').classList.remove('active');
                document.getElementById('subsystemView').classList.add('active');
            }
            
            // Sync checkbox states
            syncCheckboxes();
        }

        function syncCheckboxes() {
            // Update all checkboxes based on selectedTests
            selectedTests.forEach((test, testId) => {
                // Update category view checkboxes
                const catCheckbox = document.getElementById('check-' + testId);
                const catItem = document.getElementById('item-' + testId);
                if (catCheckbox) {
                    catCheckbox.checked = true;
                    if (catItem) catItem.classList.add('selected');
                }
                
                // Update subsystem view checkboxes
                document.querySelectorAll('[id^="check-sub-"][id$="-' + testId + '"]').forEach(checkbox => {
                    checkbox.checked = true;
                    const itemId = checkbox.id.replace('check-', 'item-');
                    const item = document.getElementById(itemId);
                    if (item) item.classList.add('selected');
                });
            });
        }

        function toggleCategory(categoryId) {
            const list = document.getElementById('list-' + categoryId);
            const category = list.parentElement;
            list.classList.toggle('expanded');
            category.classList.toggle('expanded');
        }

        function toggleTest(testId, testName, testIcon) {
            // Toggle selection
            if (selectedTests.has(testId)) {
                selectedTests.delete(testId);
            } else {
                selectedTests.set(testId, { name: testName, icon: testIcon });
            }
            
            // Update all checkboxes for this test across both views
            updateTestCheckboxes(testId);
            updateSelectedSummary();
        }
        
        function updateTestCheckboxes(testId) {
            const isSelected = selectedTests.has(testId);
            
            // Update category view
            const catCheckbox = document.getElementById('check-' + testId);
            const catItem = document.getElementById('item-' + testId);
            if (catCheckbox) {
                catCheckbox.checked = isSelected;
                if (catItem) {
                    if (isSelected) {
                        catItem.classList.add('selected');
                    } else {
                        catItem.classList.remove('selected');
                    }
                }
            }
            
            // Update all subsystem view instances
            document.querySelectorAll('[id^="check-sub-"][id$="-' + testId + '"]').forEach(checkbox => {
                checkbox.checked = isSelected;
                const itemId = checkbox.id.replace('check-', 'item-');
                const item = document.getElementById(itemId);
                if (item) {
                    if (isSelected) {
                        item.classList.add('selected');
                    } else {
                        item.classList.remove('selected');
                    }
                }
            });
        }

        function updateSelectedSummary() {
            const summary = document.getElementById('selectedSummary');
            const count = document.getElementById('selectedCount');
            const tags = document.getElementById('selectedTags');
            const btnNext = document.getElementById('btnNext1');
            
            count.textContent = selectedTests.size;
            
            if (selectedTests.size > 0) {
                summary.classList.add('visible');
                btnNext.disabled = false;
                
                tags.innerHTML = '';
                selectedTests.forEach((test, id) => {
                    const tag = document.createElement('div');
                    tag.className = 'tag';
                    tag.innerHTML = `
                        <span>${test.icon}</span>
                        <span>${test.name}</span>
                        <span class="remove" onclick="event.stopPropagation(); removeTest('${id}')">âœ–</span>
                    `;
                    tags.appendChild(tag);
                });
            } else {
                summary.classList.remove('visible');
                btnNext.disabled = true;
            }
        }

        function removeTest(testId) {
            selectedTests.delete(testId);
            updateTestCheckboxes(testId);
            updateSelectedSummary();
        }

        async function goToStep2() {
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
            
            document.getElementById('panel1').classList.remove('active');
            document.getElementById('panel2').classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Ø¯Ø±ÛŒØ§ÙØª Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ§ÛŒÙ„ Ø§Ø² Ø³Ø±ÙˆØ±
            await loadFileRequirements();
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§
            await loadTestParameters();
        }

        async function loadFileRequirements() {
            try {
                const testIds = Array.from(selectedTests.keys());
                const response = await fetch('/tests-requirements', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test_ids: testIds })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayFileRequirements(data.files);
                }
            } catch (error) {
                console.error('Error loading requirements:', error);
            }
        }

        function displayFileRequirements(files) {
            const reqBox = document.querySelector('.requirements-box');
            
            let html = '<h4>ğŸ“Š ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Excel Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:</h4>';
            html += '<div class="requirements-list">';
            
            for (const [key, file] of Object.entries(files)) {
                html += `
                    <div class="requirement-item">
                        <strong>ğŸ“ ${file.description}</strong>
                        <p style="font-size: 0.85em; color: #666; margin-top: 5px;">
                            Ù†Ø§Ù… ÙØ§ÛŒÙ„: ${file.file}
                        </p>
                        <p style="font-size: 0.85em; color: #666;">
                            Ø³ØªÙˆÙ†â€ŒÙ‡Ø§: ${file.columns.join(', ')}
                        </p>
                    </div>
                `;
            }
            
            html += '</div>';
            reqBox.innerHTML = html;
        }

        // Global object to store test parameters
        let testParametersData = new Map();

        async function loadTestParameters() {
            const container = document.getElementById('parametersContainer');
            const section = document.getElementById('parametersSection');
            
            testParametersData.clear();
            container.innerHTML = '';
            
            let hasParameters = false;
            
            for (const [testId, test] of selectedTests) {
                try {
                    const response = await fetch(`/get-test-parameters/${testId}`);
                    const data = await response.json();
                    
                    if (data.success && data.parameters && data.parameters.length > 0) {
                        hasParameters = true;
                        testParametersData.set(testId, data.parameters);
                        renderTestParameters(testId, test, data.parameters);
                    }
                } catch (error) {
                    console.error(`Error loading parameters for ${testId}:`, error);
                }
            }
            
            section.style.display = hasParameters ? 'block' : 'none';
        }

        function renderTestParameters(testId, test, parameters) {
            const container = document.getElementById('parametersContainer');
            
            const card = document.createElement('div');
            card.className = 'test-parameters-card';
            card.id = `params-${testId}`;
            
            let html = `
                <div class="test-parameters-header">
                    <span style="font-size: 1.5em;">${test.icon}</span>
                    <h4>${test.name}</h4>
                </div>
                <div class="parameter-form">
            `;
            
            parameters.forEach(param => {
                html += renderParameter(testId, param);
            });
            
            html += '</div>';
            card.innerHTML = html;
            container.appendChild(card);
        }

        function renderParameter(testId, param) {
            const inputId = `param-${testId}-${param.key}`;
            const required = param.required ? '<span class="param-required">*</span>' : '';
            
            let inputHtml = '';
            
            switch (param.type) {
                case 'number':
                    inputHtml = `
                        <input type="number" 
                            id="${inputId}" 
                            class="param-input" 
                            value="${param.defaultValue || ''}"
                            ${param.required ? 'required' : ''}
                            step="any">
                    `;
                    break;
                    
                case 'string':
                    inputHtml = `
                        <input type="text" 
                            id="${inputId}" 
                            class="param-input" 
                            value="${param.defaultValue || ''}"
                            ${param.required ? 'required' : ''}>
                    `;
                    break;
                    
                case 'date':
                    inputHtml = `
                        <input type="date" 
                            id="${inputId}" 
                            class="param-input" 
                            value="${param.defaultValue || ''}"
                            ${param.required ? 'required' : ''}>
                    `;
                    break;
                    
                case 'datetime':
                    inputHtml = `
                        <input type="datetime-local" 
                            id="${inputId}" 
                            class="param-input" 
                            value="${param.defaultValue || ''}"
                            ${param.required ? 'required' : ''}>
                    `;
                    break;
                    
                case 'boolean':
                    inputHtml = `
                        <div class="param-checkbox-container">
                            <input type="checkbox" 
                                id="${inputId}" 
                                class="param-checkbox" 
                                ${param.defaultValue ? 'checked' : ''}>
                            <label for="${inputId}">ÙØ¹Ø§Ù„</label>
                        </div>
                    `;
                    break;
                    
                case 'select':
                    inputHtml = `<select id="${inputId}" class="param-select" ${param.required ? 'required' : ''}>`;
                    if (param.options) {
                        param.options.forEach(option => {
                            const selected = option.value == param.defaultValue ? 'selected' : '';
                            inputHtml += `<option value="${option.value}" ${selected}>${option.label}</option>`;
                        });
                    }
                    inputHtml += '</select>';
                    break;
                    
                default:
                    inputHtml = `
                        <input type="text" 
                            id="${inputId}" 
                            class="param-input" 
                            value="${param.defaultValue || ''}">
                    `;
            }
            
            return `
                <div class="param-group">
                    <label class="param-label" for="${inputId}">
                        ${required}${param.displayName}
                    </label>
                    ${inputHtml}
                </div>
            `;
        }

        function collectTestParameters(testId) {
            const params = {};
            const testParams = testParametersData.get(testId);
            
            if (!testParams) {
                return params;
            }
            
            testParams.forEach(param => {
                const inputId = `param-${testId}-${param.key}`;
                const element = document.getElementById(inputId);
                
                if (element) {
                    if (param.type === 'boolean') {
                        params[param.key] = element.checked;
                    } else if (param.type === 'number') {
                        const value = parseFloat(element.value);
                        params[param.key] = isNaN(value) ? (param.defaultValue || 0) : value;
                    } else {
                        params[param.key] = element.value || param.defaultValue || '';
                    }
                } else if (param.defaultValue !== undefined && param.defaultValue !== null) {
                    // If element not found, use default value if available
                    params[param.key] = param.defaultValue;
                }
            });
            
            return params;
        }

        function goToStep1() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step1').classList.remove('completed');
            document.getElementById('step1').classList.add('active');
            
            document.getElementById('panel2').classList.remove('active');
            document.getElementById('panel1').classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function uploadFiles() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            
            if (!files || files.length === 0) return;
            
            const statusDiv = document.getElementById('fileStatus');
            statusDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´...</p></div>';
            
            let totalRecords = 0;
            let uploadedFiles = [];
            let hasError = false;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.success || data.records) {
                        totalRecords += data.records || 0;
                        uploadedFiles.push({
                            name: file.name,
                            records: data.records || 0
                        });
                    } else {
                        hasError = true;
                        statusDiv.innerHTML += `<div class="alert alert-danger"><span>âŒ</span><span>Ø®Ø·Ø§ Ø¯Ø± ${file.name}: ${data.error}</span></div>`;
                    }
                } catch (error) {
                    hasError = true;
                    statusDiv.innerHTML += `<div class="alert alert-danger"><span>âŒ</span><span>Ø®Ø·Ø§ Ø¯Ø± ${file.name}: ${error.message}</span></div>`;
                }
            }
            
            if (uploadedFiles.length > 0) {
                uploadedRecords = totalRecords;
                let html = '<div class="alert alert-success"><span>âœ…</span><span><strong>Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆÙÙ‚!</strong> ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: ' + uploadedFiles.length + ' | Ú©Ù„ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§: ' + totalRecords.toLocaleString('fa-IR') + '</span></div>';
                
                uploadedFiles.forEach(f => {
                    html += `
                        <div class="file-card">
                            <div class="icon">ğŸ“„</div>
                            <div class="file-info">
                                <h4>${f.name}</h4>
                                <p>ğŸ“Š Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§: ${f.records.toLocaleString('fa-IR')}</p>
                            </div>
                        </div>
                    `;
                });
                
                statusDiv.innerHTML = html;
                document.getElementById('btnRun').disabled = false;
            } else if (!hasError) {
                statusDiv.innerHTML = '<div class="alert alert-danger"><span>âŒ</span><span>Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§</span></div>';
            }
        }

        async function goToStep3() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.add('active');
            
            document.getElementById('panel2').classList.remove('active');
            document.getElementById('panel3').classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            await runAllTests();
        }

        async function runAllTests() {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§... Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯</p></div>';
            
            testResults = [];
            let completed = 0;
            const total = selectedTests.size;
            
            for (const [testId, test] of selectedTests) {
                try {
                    const startTime = Date.now();
                    
                    // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†
                    const params = collectTestParameters(testId);
                    
                    const response = await fetch(`/run-test/${testId}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(params)
                    });
                    
                    const data = await response.json();
                    const executionTime = ((Date.now() - startTime) / 1000).toFixed(2);
                    
                    testResults.push({
                        id: testId,
                        name: test.name,
                        icon: test.icon,
                        success: data.success,
                        count: data.count || 0,
                        results: data.results || [],
                        error: data.error,
                        executionTime: executionTime
                    });
                    
                    completed++;
                    container.innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            <p class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§... (${completed}/${total})</p>
                            <p style="color: #666; margin-top: 10px;">Ø¢Ø²Ù…ÙˆÙ†: ${test.name}</p>
                        </div>
                    `;
                    
                } catch (error) {
                    testResults.push({
                        id: testId,
                        name: test.name,
                        icon: test.icon,
                        success: false,
                        error: error.message,
                        executionTime: 0
                    });
                }
            }
            
            displayResults();
        }

        function displayResults() {
            const container = document.getElementById('resultsContainer');
            let html = '';
            
            const successCount = testResults.filter(r => r.success).length;
            const failCount = testResults.length - successCount;
            const totalRecords = testResults.reduce((sum, r) => sum + (r.count || 0), 0);
            
            html += `
                <div class="alert alert-success">
                    <span style="font-size: 1.5em;">ğŸ“Š</span>
                    <div>
                        <strong>Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§:</strong> ${successCount} Ø¢Ø²Ù…ÙˆÙ† Ù…ÙˆÙÙ‚ØŒ ${failCount} Ø®Ø·Ø§
                        | Ú©Ù„ Ù†ØªØ§ÛŒØ¬: ${totalRecords.toLocaleString('fa-IR')} Ø±Ú©ÙˆØ±Ø¯
                    </div>
                </div>
            `;
            
            testResults.forEach((result, index) => {
                html += `
                    <div class="test-result-card">
                        <div class="result-header">
                            <div class="result-title">
                                <span style="font-size: 1.8em;">${result.icon}</span>
                                <h3>${result.name}</h3>
                            </div>
                            <span class="result-status ${result.success ? 'status-success' : 'status-error'}">
                                ${result.success ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ø®Ø·Ø§'}
                            </span>
                        </div>
                `;
                
                if (result.success) {
                    html += `
                        <div class="result-stats">
                            <div class="stat-box">
                                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ù†ØªØ§ÛŒØ¬</div>
                                <div class="stat-value">${result.count.toLocaleString('fa-IR')}</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§</div>
                                <div class="stat-value">${result.executionTime} Ø«Ø§Ù†ÛŒÙ‡</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">ÙˆØ¶Ø¹ÛŒØª</div>
                                <div class="stat-value" style="font-size: 1.3em;">${result.count > 0 ? 'âš ï¸ ÛŒØ§ÙØª Ø´Ø¯' : 'âœ… Ù…Ø´Ú©Ù„ÛŒ Ù†ÛŒØ³Øª'}</div>
                            </div>
                        </div>
                    `;
                    
                    if (result.results && result.results.length > 0) {
                        html += '<div class="result-details">';
                        html += '<h4 style="margin-bottom: 15px; color: #667eea;">ğŸ“‹ Ø¬Ø²Ø¦ÛŒØ§Øª Ù†ØªØ§ÛŒØ¬ (Ù†Ù…Ø§ÛŒØ´ ' + Math.min(10, result.results.length) + ' Ø§Ø² ' + result.count + ' Ø±Ú©ÙˆØ±Ø¯):</h4>';
                        
                        const keys = Object.keys(result.results[0]);
                        html += '<table class="result-table"><thead><tr>';
                        keys.forEach(key => {
                            html += `<th>${key}</th>`;
                        });
                        html += '</tr></thead><tbody>';
                        
                        result.results.slice(0, 10).forEach(row => {
                            html += '<tr>';
                            keys.forEach(key => {
                                let value = row[key];
                                if (typeof value === 'number' && value > 1000) {
                                    value = value.toLocaleString('fa-IR');
                                } else if (value === null || value === undefined) {
                                    value = '-';
                                }
                                html += `<td>${value}</td>`;
                            });
                            html += '</tr>';
                        });
                        
                        html += '</tbody></table></div>';
                    } else {
                        html += '<div class="alert alert-success"><span>âœ…</span><span>Ù‡ÛŒÚ† Ù…ÙˆØ±Ø¯ Ù…Ø´Ú©ÙˆÚ©ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!</span></div>';
                    }
                } else {
                    html += `<div class="error-message"><strong>Ø®Ø·Ø§:</strong> ${result.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ'}</div>`;
                }
                
                html += '</div>';
            });
            
            container.innerHTML = html;
        }

        function resetAll() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
                location.reload();
            }
        }

        function exportAll() {
            alert('Ù‚Ø§Ø¨Ù„ÛŒØª Ø®Ø±ÙˆØ¬ÛŒ Excel Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª...');
        }
    </script>
</body>
</html>
